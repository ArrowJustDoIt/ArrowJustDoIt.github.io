<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0">
  <channel>
    <title>fantaster | 杨柳青</title>
    <link>http://杨柳青一些事.中国</link>
    <description>My personal blog</description>
    
      <item>
        <title>memcache实现高可用方案</title>
        <link>http://杨柳青一些事.中国/2015/08/16/Linux%20-%20memcache.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2015/08/16/Linux%20-%20memcache.html</guid>
        <pubDate>Sun, 16 Aug 2015 00:00:00 +0800</pubDate>
        <description>&lt;h1&gt;memcache实现高可用方案&lt;/h1&gt;

&lt;p&gt;源码：&lt;a href=&quot;http://yunpan.cn/cHqfqdQagStBV&quot;&gt;http://yunpan.cn/cHqfqdQagStBV&lt;/a&gt;  访问密码 cb6f&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;实现方案&lt;/strong&gt;：使用&lt;code&gt;repcached&lt;/code&gt;实现高可用&lt;br/&gt;
repcached：全称 replication cached是由日本人发明的memcached的高可用性技术，简称&lt;code&gt;复制缓冲区技术&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;使用场景&lt;/strong&gt;：它是一个&lt;strong&gt;单master&lt;/strong&gt; &lt;strong&gt;单slave&lt;/strong&gt;的方案，但它的 master/slave都是可读写的，而且可以相互同步，如果 master 宕机， slave侦测后，它会自动 listen成为 master；而如果 slave坏掉， master也会侦测到连接断，它就会重新 listen等待新的 slave加入。&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;实现步骤&lt;/strong&gt;：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;环境搭建
&lt;code&gt;&amp;gt; yum -y install gcc gcc-c++ libevent-devel&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;下载 memcached-1.2.8-repcached-2.2.tar.gz
&lt;code&gt;&amp;gt; wget http://downloads.sourceforge.net/repcached/memcached-1.2.8-repcached-2.2.tar.gz&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;解压配置repcached
&lt;code&gt;&amp;gt; tar zxvf memcached-1.2.8-repcached-2.2.tar.gz&lt;/code&gt;
&lt;code&gt;&amp;gt; ./configure --enable-replication --program-transform-name=s/memcached/repcached/&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;编译安装 
&lt;code&gt;&amp;gt; make &amp;amp;&amp;amp; make install&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;启动repcached (&lt;strong&gt;注意不要使用 root 来启动服务&lt;/strong&gt;)&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;启动主服务
&lt;code&gt;&amp;gt;  /usr/local/bin/repcached -p 11211 -v -d&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;启动从服务
&lt;code&gt;&amp;gt;  /usr/local/bin/repcached -p 11212 -x localhost -v -d&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;注意：可以使用 &lt;code&gt;ps aux | grep repcached&lt;/code&gt;  命令来查看进程&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;参数解释
-d ： 后台运行memcached进程
-p ： 默认监听端口11211  11212
-x ： 监听高可用机器，如果是监听默认端口不用写端口号，localhost就是监听本机,作用：第二个repcached监听第一个repcached如果有问题就接管&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;测试
先链接 11211 这个端口的服务，设置name 的值是  asion
&lt;code&gt;&amp;gt; telnet localhost 11211&lt;/code&gt;
&lt;code&gt;&amp;gt; set name 0 0 5&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;注意：在telnet 使用 quit 回车退出&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;然后使用 11212 这个端口的服务
    &lt;code&gt;&amp;gt; telnet localhost 11212&lt;/code&gt;
    &lt;code&gt;&amp;gt; get name&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;同样的测试可以反之在进行&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;实验完成!&lt;/strong&gt;&lt;/p&gt;
</description>
      </item>
    
      <item>
        <title>大型网站提速方案</title>
        <link>http://杨柳青一些事.中国/2015/08/01/http.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2015/08/01/http.html</guid>
        <pubDate>Sat, 01 Aug 2015 00:00:00 +0800</pubDate>
        <description>&lt;h2&gt;如何判定一个网站是大型网站&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;高访问就是大网站？还是大流量是大型网站？&lt;/strong&gt;
可以通过如下工具网站来查看一个网站的一些参数情况
&lt;a href=&quot;http://www.aizhan.com/&quot;&gt;爱站&lt;/a&gt;   &lt;a href=&quot;http://tool.chinaz.com/&quot;&gt;站长工具&lt;/a&gt; &lt;a href=&quot;https://www.hao123.com&quot;&gt;高访问网站&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;通过几个参数来判定一个大型网站&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;PV(page views) ：一个网站内所有页面，24小时内访问次数的总和。一般在100w，1000w以上&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;UV(unique visitor)：一个网站24小时内的独立访问用户。一般几十万以上&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;IP(独立IP)：一个网站24小时内访问的IP数，在考虑校园网、局域网的时候，UV数一般略大于IP数(局域网通过一个网关上网，多个用户只会记录一个独立IP)&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;总结：PV UV IP&lt;/p&gt;

&lt;h2&gt;大型网站带来的问题&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;高并发：一般是1s内同时访问一个网站的数量&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;大流量：大量的用户访问网站，流量会变得很大&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;大数据：在访问量巨大的同时，带来的就是大量数据（G、T级别）的检索问题，如何在众多数据中检索出需要的数据&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;解决方案&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;高并发可以使用 分层来解决(负载均衡)&lt;/strong&gt;
&amp;gt; 硬件：f5（优点：立竿见影；缺点：价格昂贵，20w左右）
&amp;gt; 软件：nginx(web服务器，负载均衡器),lvs
nginx: http://www.nginx.cn/   http://tengine.taobao.org/   http://nginx.org/
lvs（章文嵩）: http://zh.linuxvirtualserver.org/
&amp;gt; 负载均衡的策略：1. 轮询  2. NAT  3. 智能DNS&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;注意：对Apache实现了分流，但对Mysql，如何解决？同时，如何保证Apache，负载均衡器的高可用？&lt;/strong&gt;
高可用可以使用冗余技术实现，添加一个监控服务器软件：&lt;strong&gt;keepalive&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;大流量可以使用如下方案解决&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;1. 代码压缩 查看HTTP请求，Apache对主体数据进行压缩，开启Apache的deflate模块
    &amp;gt; http://blog.csdn.net/cctv_hu/article/details/6018942
    &amp;gt; http://www.webkaka.com/tutorial/server/2015/021013/

2. 合并文件，减少HTTP请求（js、 css），css图片背景的图片精灵(减少请求)
    &amp;gt; 合并工具： http://tool.oschina.net/jscompress?type=3

3. 使用CDN技术加载静态资源
    &amp;gt; 加速CDN服务： http://www.bootcdn.cn/

4. 将服务分散，图片服务器，电脑模块。将不同的模块部署到不同的服务器上面 (上传插件配置上传服务器地址)
    &amp;gt; PHP FTP 函数：http://www.w3school.com.cn/php/php_ref_ftp.asp

5. 升级带宽(100M带宽一年40w左右)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;大数据可以使用缓存技术实现&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;1. 磁盘缓存（静态化）：
    &amp;gt; 1. 真静态：在效率上，生成真实的html文件，将数据从数据库取出之后，生成的静态html保存到磁盘上面，直接访问静态页面就好。不用访问数据库，减轻数据库的压力
    &amp;gt; 2. 伪静态：在形式上，利用Apache的重写模块来实现 动态的url 转换成静态的url，便于seo（搜索引擎优化），可以防止sql注入
    例如：
    动态网站：`http://www.php.com?new.php&amp;amp;type=sport&amp;amp;id=12`
    对应的静态网站：`http://www.php.com?new-sport-id12.html`

2. 内存缓存（Nosql技术，memcache、redis、mongodb）：将Mysql取出的数据保存在内存服务器里面，下次请求的时候直接访问内存服务器

3. 数据库优化：

    1. 设计上满足三范式 
    2. 字段上使用合适的属性 
    3. 合适的使用索引 
    4. 分区和分表
    5. 主从复制(读写分离)
    6. 硬件升级（scale up、还有scale out）
    7. sphinx存储引擎的使用
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
      </item>
    
      <item>
        <title>Linux 4：磁盘与文件系统管理</title>
        <link>http://杨柳青一些事.中国/2015/07/06/Linux4.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2015/07/06/Linux4.html</guid>
        <pubDate>Mon, 06 Jul 2015 00:00:00 +0800</pubDate>
        <description>&lt;h3&gt;认识EXT2文件系统&lt;/h3&gt;

&lt;p&gt;每种操作系统能够使用的文件系统并不相同。 举例来说，windows 98以前的微软操作系统主要利用的文件系统是&lt;code&gt;FAT(或FAT16)&lt;/code&gt;，windows 2000以后的版本有所谓的&lt;code&gt;NTFS&lt;/code&gt;文件系统，至于Linux的正统文件系统则为&lt;code&gt;Ext2&lt;/code&gt;(Linux second extended file system, ext2fs)这一个。此外，在默认的情况下，windows操作系统是不会认识Linux的Ext2的。&lt;/p&gt;

&lt;p&gt;那么文件系统是如何运行的呢？这与操作系统的文件数据有关。较新的操作系统的文件数据除了文件实际内容外，通常含有非常多的属性，例如Linux操作系统的文件权限(rwx)与文件属性(拥有者、群组、时间参数等)。 文件系统通常会将这两部份的数据分别存放在不同的区块，权限与属性放置到&lt;code&gt;inode&lt;/code&gt;中，至于实际数据则放置到&lt;code&gt;data block&lt;/code&gt;区块中。 另外，还有一个超级区块(&lt;code&gt;superblock&lt;/code&gt;)会记录整个文件系统的整体信息，包括inode与block的总量、使用量、剩余量等。&lt;/p&gt;

&lt;h3&gt;文件系统的简单操作&lt;/h3&gt;

&lt;h3&gt;磁盘的分割、格式化、检验与挂载&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;磁盘分区： fdisk, partprobe&lt;/li&gt;
&lt;li&gt;磁盘格式化： mkfs, mke2fs&lt;/li&gt;
&lt;li&gt;磁盘检验： fsck, badblocks&lt;/li&gt;
&lt;li&gt;磁盘挂载与卸除： mount, umount&lt;/li&gt;
&lt;li&gt;磁盘参数修订： mknod, e2label, tune2fs, hdparm&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;配置启动挂载&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;启动挂载 /etc/fstab 及 /etc/mtab&lt;/li&gt;
&lt;li&gt;特殊装置 loop 挂载(映象档不刻录就挂载使用)&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;内存置换空间(swap)之建置&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;使用实体分割槽建置swap&lt;/li&gt;
&lt;li&gt;使用文件建置swap&lt;/li&gt;
&lt;li&gt;swap使用上的限制&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;文件系统的特殊观察与操作&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;boot sector 与 superblock 的关系&lt;/li&gt;
&lt;li&gt;磁盘空间之浪费问题&lt;/li&gt;
&lt;li&gt;利用 GNU 的 parted 进行分割行为&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;重点回顾&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;基本上 Linux 的正统文件系统为 Ext2 ，该文件系统内的信息主要有：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;superblock：记录此 filesystem 的整体信息，包括inode/block的总量、使用量、剩余量， 以及文件系统的格式与相关信息等；&lt;/li&gt;
&lt;li&gt;inode：记录文件的属性，一个文件占用一个inode，同时记录此文件的数据所在的 block 号码；&lt;/li&gt;
&lt;li&gt;block：实际记录文件的内容，若文件太大时，会占用多个 block 。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Ext2 文件系统的数据存取为索引式文件系统(indexed allocation)&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;需要碎片整理的原因就是文件写入的 block 太过于离散了，此时文件读取的效能将会变的很差所致。 这个时候可以透过碎片整理将同一个文件所属的 blocks 汇整在一起。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Ext2文件系统主要有：boot sector, superblock, inode bitmap, block bitmap, inode table, data block 等六大部分。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;data block 是用来放置文件内容数据地方，在 Ext2 文件系统中所支持的 block 大小有 1K, 2K 及 4K 三种而已&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;inode 记录文件的属性/权限等数据，其他重要项目为： 每个 inode 大小均固定为 128 bytes； 每个文件都仅会占用一个 inode 而已； 因此文件系统能够创建的文件数量与 inode 的数量有关；&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;文件的 block 在记录文件的实际数据，目录的 block 则在记录该目录底下文件名与其 inode 号码的对照表；&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;日志式文件系统 (journal) 会多出一块记录区，随时记载文件系统的主要活动，可加快系统复原时间；&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Linux 文件系统为添加效能，会让主存储器作为大量的磁盘高速缓存；&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;实体链接只是多了一个文件名对该 inode 号码的链接而已；&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;符号链接就类似Windows的快捷方式功能。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;磁盘的使用必需要经过：分割、格式化与挂载，分别惯用的命令为：fdisk, mkfs, mount三个命令&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;启动自动挂载可参考/etc/fstab之配置，配置完毕务必使用 mount -a 测试语法正确否；&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;参考资料&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://vbird.dic.ksu.edu.tw/linux_basic/0230filesystem.php#harddisk&quot;&gt;鸟哥的Linux私房菜 第八章&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      </item>
    
      <item>
        <title>Linux 3：文件与目录管理</title>
        <link>http://杨柳青一些事.中国/2015/07/05/Linux3.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2015/07/05/Linux3.html</guid>
        <pubDate>Sun, 05 Jul 2015 00:00:00 +0800</pubDate>
        <description>&lt;h3&gt;目录的相关操作&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;.         # 代表此层目录
..        # 代表上一层目录
-         # 代表前一个工作目录
~         # 代表『目前使用者身份』所在的家目录
~account  # 代表 account 这个使用者的家目录(account是个帐号名称)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;在所有目录底下都会存在的两个目录，分别是&lt;code&gt;.&lt;/code&gt;与&lt;code&gt;..&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;根目录的上一层&lt;code&gt;(..)&lt;/code&gt;与根目录自己&lt;code&gt;(.)&lt;/code&gt;是同一个目录&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;几个常见的处理目录的命令&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;cd：变换目录，cd是Change Directory的缩写&lt;/li&gt;
&lt;li&gt;pwd：显示目前的目录，pwd是Print Working Directory的缩写&lt;/li&gt;
&lt;li&gt;mkdir：创建一个新的目录&lt;/li&gt;
&lt;li&gt;rmdir：删除一个空的目录&lt;/li&gt;
&lt;li&gt;mv：移动文件&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;pwd -P                   # -P：代表显示正确的完整路径，而不是连接路径
mkdir -m xxx             # -m：直接配置文件的权限
mkdir -p test1/test2     # -p：直接将所需要的目录(包含上一级目录)递回创建起来！
PATH=&amp;quot;$PATH&amp;quot;:/root       # 将/root路径加入PATH环境变量中
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;文件与目录管理&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;文件与目录的检视： ls&lt;/li&gt;
&lt;li&gt;复制、删除与移动： cp, rm, mv&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;cp -a        # 将文件的所有特性都一起复制过来
cp -p        # 连同文件的属性一起复制过去，而非使用默认属性(备份常用)
cp -r        # 可以复制目录，但是，文件与目录的权限可能会被改变
rm -i        # 互动模式，在删除前会询问使用者是否动作
rm -r        # 连目录下的东西一起删掉，并且不会询问，慎用
mv -f        # force强制移动，如果目标文件已经存在，不会询问而直接覆盖
mv -i        # 若目标文件 (destination) 已经存在时，就会询问是否覆盖
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;文件内容查询&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;直接检视文件内容： cat, tac, nl （常用）&lt;/li&gt;
&lt;li&gt;可翻页检视： more, less （常用）&lt;/li&gt;
&lt;li&gt;数据撷取： head, tail&lt;/li&gt;
&lt;li&gt;非纯文字档： od&lt;/li&gt;
&lt;li&gt;修改文件时间与建置新档： touch&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;cat [-AbEnTv] filename # 由第一行开始显示文件内容。-b列出非空白行行号；-n列出所有行号。
tac                    # 从最后一行开始显示文件内容，tac就是cat倒着写！
nl                     # 显示文件内容，顺便输出行号
more                   # 一页一页地显示文件内容
less                   # 与more类似，但可以往前翻页
head [-n number]       # 只看文件头几行，默认是10行，number是自定义行数
tail                   # 只看文件尾几行，文件很大的时候常用
od                     # 以二进制方式读取文件内容
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;文件与目录的默认权限与隐藏权限&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;文件默认权限：umask&lt;/li&gt;
&lt;li&gt;文件隐藏属性： chattr, lsattr&lt;/li&gt;
&lt;li&gt;文件特殊权限：SUID, SGID, SBIT, 权限配置&lt;/li&gt;
&lt;li&gt;观察文件类型：file&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;umask           # 后三位数是被拿走的权限分数，比如0022，u没有被拿走权限，g和o被拿走了w权限
umask -S        # 以符号类型来显示权限
umask number    # 配置自己需要的权限
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在默认的情况中，root的umask会拿掉比较多的属性，root的umask默认是&lt;code&gt;022&lt;/code&gt;， 这是基於安全的考量啦～至於一般身份使用者，通常他们的 umask 为&lt;code&gt;002&lt;/code&gt; ，亦即保留同群组的写入权力。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;特殊权限&lt;code&gt;s&lt;/code&gt;和&lt;code&gt;t&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Set UID，简称SUID，当s标志在文件拥有者的x项目为SUID，对目录无效&lt;/li&gt;
&lt;li&gt;Set GID，简称SGID，当s标志在群组的x项目为SGID，对目录有效&lt;/li&gt;
&lt;li&gt;Sticky Bit, 简称SBIT，目前只针对目录有效，对於文件已经没有效果了&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;配置SUID,SGID,SBIT权限&lt;/h3&gt;

&lt;p&gt;在原有的权限数字前面加上需要配置的权限数字。
比如&lt;code&gt;755&lt;/code&gt;-&amp;gt;&lt;code&gt;4755&lt;/code&gt; ，就意味着&lt;code&gt;-rwxr-xr-x&lt;/code&gt;变为了&lt;code&gt;-rwsr-xr-x&lt;/code&gt;。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;4 为 SUID&lt;/li&gt;
&lt;li&gt;2 为 SGID&lt;/li&gt;
&lt;li&gt;1 为 SBIT&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;chmod 4755 filename
chmod u=rwxs,go=x test; ls -l test      # 配置权限为-rws--x--x的模样
chmod g+s,o+t test; ls -l test          # 配置权限为-rws--s--t，即加入SGID,SBIT权限
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;命令与文件的搜寻&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;命令档名的搜寻：which&lt;/li&gt;
&lt;li&gt;文件档名的搜寻：whereis, locate, find&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;权限与命令的关系&lt;/h3&gt;

&lt;h4&gt;一、让使用者能进入某目录成为『可工作目录』的基本权限为何：&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;可使用的命令：例如 cd 等变换工作目录的命令；&lt;/li&gt;
&lt;li&gt;目录所需权限：使用者对这个目录至少需要具有 x 的权限&lt;/li&gt;
&lt;li&gt;额外需求：如果使用者想要在这个目录内利用 ls 查阅档名，则使用者对此目录还需要 r 的权限。&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;二、使用者在某个目录内读取一个文件的基本权限为何？&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;可使用的命令：例如本章谈到的 cat, more, less等等&lt;/li&gt;
&lt;li&gt;目录所需权限：使用者对这个目录至少需要具有 x 权限；&lt;/li&gt;
&lt;li&gt;文件所需权限：使用者对文件至少需要具有 r 的权限才行！&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;三、让使用者可以修改一个文件的基本权限为何？&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;可使用的命令：例如 nano 或未来要介绍的 vi 编辑器等；&lt;/li&gt;
&lt;li&gt;目录所需权限：使用者在该文件所在的目录至少要有 x 权限；&lt;/li&gt;
&lt;li&gt;文件所需权限：使用者对该文件至少要有 r, w 权限&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;四、让一个使用者可以创建一个文件的基本权限为何？&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;目录所需权限：使用者在该目录要具有 w,x 的权限，重点在 w 啦！&lt;/li&gt;
&lt;/ul&gt;

&lt;h4&gt;五、让使用者进入某目录并运行该目录下的某个命令之基本权限为何？&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;目录所需权限：使用者在该目录至少要有 x 的权限；&lt;/li&gt;
&lt;li&gt;文件所需权限：使用者在该文件至少需要有 x 的权限&lt;/li&gt;
&lt;/ul&gt;
</description>
      </item>
    
      <item>
        <title>Linux 2：文件权限与目录配置</title>
        <link>http://杨柳青一些事.中国/2015/07/04/Linux2.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2015/07/04/Linux2.html</guid>
        <pubDate>Sat, 04 Jul 2015 00:00:00 +0800</pubDate>
        <description>&lt;p&gt;Linux最优秀的地方之一，就在于它的多用户、多任务环境。Linux一般将文件可存取访问的身份分为3个类别，分别是owner（用户）、group（用户组）、others（其他人），且3种身份都各自有自己的read，write，execute等权限。&lt;/p&gt;

&lt;h3&gt;用户身份与用户组记录的文件&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;\etc\passwd     #所有系统账号的相关信息
\etc\shadow     #个人的密码
\etc\group      #Linux所有的组名
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;文件权限概念&lt;/h3&gt;

&lt;p&gt;当屏幕前面出现“Permission deny”的时候，肯定是权限设置错误。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;ls -al          #ls:list，列出所有文件的详细信息
ls -l           #显示文件，属性的第一个字段是文件的权限，共10位，比如-rwxr-xr--，表示owner具有rwx权限，group具有rx权限，others只具有r权限
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;改变文件属性与权限&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;chgrp       #改变文件所属用户组，具体句法记得使用 man page 查询
chown -R 用户账号:所在组群 文件名      #改变文件所有者
chmod       #改变文件的权限
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中，chmod修改权限的方法有两种，分别是符号法与数字法，数字法中r，w，x的数值分别是4，2，1。&lt;/p&gt;

&lt;p&gt;要开放“目录”（注意不是“文件”）给任何人看，应该至少同时给予r和x权限，但w权限不可随便给予。&lt;/p&gt;

&lt;h3&gt;文件种类与扩展名&lt;/h3&gt;

&lt;p&gt;使用&lt;code&gt;ls -l&lt;/code&gt;查看到的十个字符中，第一个字符为文件的类型：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;-: 普通文件（regular file）&lt;/li&gt;
&lt;li&gt;d: 目录文件（directory）&lt;/li&gt;
&lt;li&gt;l: 连接文件，类似于windows的快捷方式（link）&lt;/li&gt;
&lt;li&gt;b: 块设备文件（block）&lt;/li&gt;
&lt;li&gt;c: 字符设备文件（character）&lt;/li&gt;
&lt;li&gt;s: 套接字（sockets）&lt;/li&gt;
&lt;li&gt;p: 管道（FIFO, pipe）&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;Linux目录配置标准：FHS&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/public/img/linuxDIRTREE.gif&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;

&lt;p&gt;根据FHS的定义，最好将&lt;code&gt;/var&lt;/code&gt;独立出来，这样至少/var死掉的时候，根目录还活着，还能够进入救援模式。&lt;/p&gt;

&lt;h3&gt;绝对路径与相对路径&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;cd/var/log(absolute)&lt;/li&gt;
&lt;li&gt;cd../var/log(relative)&lt;/li&gt;
&lt;li&gt;.: 代表当前的目录，也可以用./来表示&lt;/li&gt;
&lt;li&gt;..: 代表上一层目录，也可以用../来表示&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;例子&lt;/h3&gt;

&lt;p&gt;将install.log文件复制成为LAYtest.log，并且要给linanya这个人读写权限，可以这样做：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;[root@localhost ~]# cp install.log LAYtest.log     #若复制文件夹，用cp -r
[root@localhost ~]# ls -al LAYtest.log 
-rw-r--r-- 1 root root 62826 9月  17 15:19 LAYtest.log     #虽然完成了复制，但仍然是root的文件
[root@localhost ~]# chown linanya LAYtest.log 
[root@localhost ~]# ls -al LAYtest.log       
-rw-r--r-- 1 linanya root 62826 9月  17 15:19 LAYtest.log  #文件变成linanya的
[root@localhost ~]# 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
      </item>
    
      <item>
        <title>Linux 1：登陆与在线求助man page</title>
        <link>http://杨柳青一些事.中国/2015/07/03/Linux.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2015/07/03/Linux.html</guid>
        <pubDate>Fri, 03 Jul 2015 00:00:00 +0800</pubDate>
        <description>&lt;h3&gt;查看内核版本&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;uname -r
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;稳定版本的偶数版，如2.6.x，适合于商业与家用环境使用；开发中版本，如2.5.x，适合开发特殊功能的环境。&lt;/p&gt;

&lt;h3&gt;登陆&lt;/h3&gt;

&lt;p&gt;Mac：（若以root身份登陆，将username改为root）&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;ssh username@IPaddress
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Linux：(若以root身份登陆，将username删掉）Linux默认root的提示符为#,而一般身份用户的提示符为$。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;su - username
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;注销Linux&lt;/h3&gt;

&lt;p&gt;注销Linux并不意味着关机，只是用户离开系统。&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;基础命令的操作&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;command [-options] parameter1 parameter2 ···
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;echo $LANG   #显示目前支持的语言
LANG=en_US   #将语言改为英文系
date         #显示日期与实践
cal 10 2014  #显示日历
bc           #计算器
quit         #退出
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;重要的热键&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;[tab]&lt;/code&gt;：连按两次，具有“命令补全”和“文件补齐”的作用。
&lt;code&gt;[control]+c&lt;/code&gt;：中断目前程序。
&lt;code&gt;[control]+d&lt;/code&gt;：键盘输入结束；直接离开文字界面（相当于`&lt;code&gt;exit&lt;/code&gt;）。&lt;/p&gt;

&lt;h3&gt;在线求助 man page&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;man command  #command是要查询的命令名称
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;进入man命令后，可按&lt;code&gt;空格&lt;/code&gt;往下翻页，按&lt;code&gt;q&lt;/code&gt;键离开。
在man page中，可以在任何时候输入&lt;code&gt;/keyword&lt;/code&gt;来查询关键字，比如/date.&lt;/p&gt;

&lt;h3&gt;正确的关机方法&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;who         #查看目前有谁在线
netstat -a  #查看网络的联机状态
ps -aux     #查看后台执行的程序
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;数据同步写入磁盘：为了防止不正常关机导致的内存数据没有来得及写入磁盘，在文字界面输入&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;sync 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;惯用的关机命令：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;shutdown -h now     #立刻关机
shutdown -h 20:25   #晚上8点25分关机
shutdown -h +10     #过十分钟后关机
shutdown -r now     #立刻重启
shutdown -r +30 ‘The system will be reboot’    #再过30分钟关机，并显示后面的消息给所有在线用户
shutdown -k now ‘The system will be reboot’    #仅发出警告，系统并不会真正关机
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;重启、关机：reboot，halt，poweroff。务必用man去查询一下。&lt;/p&gt;
</description>
      </item>
    
      <item>
        <title>Linux 0：实际问题</title>
        <link>http://杨柳青一些事.中国/2015/07/02/Linux-Problems.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2015/07/02/Linux-Problems.html</guid>
        <pubDate>Thu, 02 Jul 2015 00:00:00 +0800</pubDate>
        <description>&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://book.douban.com/subject/4889838/&quot;&gt;《鸟哥的Linux私房菜——基础学习篇》&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://book.douban.com/subject/2338464/&quot;&gt;《鸟哥的Linux私房菜——服务器架设篇》&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;本系列文章分为两部分：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;系统学习上面两本书的笔记。&lt;/li&gt;
&lt;li&gt;实际中遇到的问题及解决方案，即本文内容。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;实际问题&lt;/h2&gt;

&lt;h2&gt;1. 建立网络映射&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Mac：&lt;code&gt;Finder&lt;/code&gt;-&amp;gt;&lt;code&gt;前往&lt;/code&gt;-&amp;gt;&lt;code&gt;连接服务器&lt;/code&gt;-&amp;gt;输入&lt;code&gt;smb://IPaddress/samba&lt;/code&gt;-&amp;gt;&lt;code&gt;连接&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Linux：&lt;code&gt;位置&lt;/code&gt;-&amp;gt;&lt;code&gt;连接服务器&lt;/code&gt;-&amp;gt;“服务类型”选择&lt;code&gt;自定义位置&lt;/code&gt;-&amp;gt;输入&lt;code&gt;smb://IPaddress/samba&lt;/code&gt;-&amp;gt;&lt;code&gt;连接&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;2. ssh登陆失败&lt;/h2&gt;

&lt;p&gt;以root身份远程登陆服务器，密码正确，却显示如下警告：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;man-in-the-middle attack&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;!
It is also possible that a host key has just been changed.
The fingerprint &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; the RSA key sent by the remote host is
3a:17:4b:6e:62:e6:94:df:09:78:99:90:51:68:18:62.
Please contact your system administrator.
Add correct host key in /Users/AnyaLin/.ssh/known_hosts to get rid of this message.
Offending RSA key in /Users/AnyaLin/.ssh/known_hosts:4
RSA host key &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; 222.195.93.129 has changed and you have requested strict checking.
Host key verification failed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;解决方法：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;vi ~/.ssh/known_hosts     &lt;span class=&quot;c&quot;&gt;#选中最后一条登陆记录，双击`d`删除，按“：”进入末行编辑模式，输入“x”，回车&lt;/span&gt;
ssh root@222.195.93.129   &lt;span class=&quot;c&quot;&gt;#再次登陆&lt;/span&gt;
The authenticity of host &lt;span class=&quot;s1&quot;&gt;&amp;#39;222.195.93.129 (222.195.93.129)&amp;#39;&lt;/span&gt; can&lt;span class=&quot;err&quot;&gt;&amp;#39;&lt;/span&gt;t be established.
RSA key fingerprint is 3a:17:4b:6e:62:e6:94:df:09:78:99:90:51:68:18:62.
Are you sure you want to &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt; connecting &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;yes/no&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;?    &lt;span class=&quot;c&quot;&gt;#输入yes&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;3. tar.gz 文件解压&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;打开终端&lt;/li&gt;
&lt;li&gt;进入需要解压的xxxx.tar.gz文件所在目录&lt;/li&gt;
&lt;li&gt;$ tar xvfz xxxx.tar.gz&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt; HEAD&lt;/p&gt;

&lt;h2&gt;4. 新建文件命令&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;touch a.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;=======&lt;/p&gt;

&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;cc60f2ed32a5f9727a68a2eb7f2f6a8a1eeac51a&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
&lt;/blockquote&gt;
</description>
      </item>
    
      <item>
        <title>Linux环境下redis的搭建</title>
        <link>http://杨柳青一些事.中国/2015/05/16/linux-redis.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2015/05/16/linux-redis.html</guid>
        <pubDate>Sat, 16 May 2015 00:00:00 +0800</pubDate>
        <description>&lt;h1&gt;本文主要介绍Linux环境下redis的搭建&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;http://yunpan.cn/cHqjyAVnp8hps&quot;&gt;redis 源码包&lt;/a&gt;  访问密码 e97d&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;操作系统环境&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
&lt;p&gt;[root@asion ~]#   lsb_release  -a
LSB-Version:core-4.0-ia32:core-4.0-noarch:graphics-4.0-ia32:gr  aphics-4.0-noarch:printing-4.0-ia32:printing-4.0-noarch
Distributor ID:  CentOS
Description:    CentOS release 5.5 (Final)
Release:        5.
Codename:      Final&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;编译环境准备&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;yum -y install make apr* autoconf automake curl-devel gcc gcc-c++ zlib-devel openssl openssl-devel pcre-devel gd kernel keyutils patch perl kernel-headers compat* mpfr cpp glibc libgomp libstdc++-devel ppl cloog-ppl keyutils-libs-devel libcom_err-devel libsepol-devel libselinux-devel krb5-devel zlib-devel libXpm* freetype libjpeg* libpng* php-common php-gd ncurses* libtool* libxml2 libxml2-devel patch cmake&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;安装TCL，不然 redis 的 make test 不会通过。也可以先安装 redis 再回过头来装 TCL (这步可忽略)
&lt;a href=&quot;http://sourceforge.net/projects/tcl/files/Tcl/&quot;&gt;下载地址&lt;/a&gt; 
编译安装：&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;tar xvzf tcl8.6.1-src.tar.gz
cd tcl8.6.1/unix/
./configure
make
make test
make install&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;http://redis.io/&quot;&gt;下载redis源码&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;wget  http://download.redis.io/releases/redis-3.0.4.tar.gz&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;ol&gt;
&lt;li&gt;解压下载的文件(无须configure，在make install 的时候指定安装地址，PREFIX 需要大写)
&amp;gt; tar -zxvf redis-3.0.4.tar.gz&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;编译安装&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;cd redis-3.0.4
make
make PREFIX=/usr/local/redis install
cp redis.conf /usr/local/redis/redis.conf &lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;注意：
如果在执行 make 的时候遇到以下错误(比如本人的 32 位的 CentOS5.5 就碰到了)：&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
&lt;p&gt;zmalloc.o: In function zmalloc&lt;em&gt;used&lt;/em&gt;memory:
/home/defonds/redis/redis-2.8.10/src/zmalloc.c:223: undefined reference to `_&lt;em&gt;sync&lt;/em&gt;add&lt;em&gt;and&lt;/em&gt;fetch_4&amp;#39;
collect2: ld returned 1 exit status
make[1]: *** [redis-server] Error 1
make[1]: Leaving directory /home/defonds/redis/redis-2.8.10/src
make: *** [all] Error 2&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;解决方案：在执行 make 时加上参数 CFLAGS=&amp;quot;-march=i686&amp;quot; 就可以了：&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;make CFLAGS=&amp;quot;-march=i686&amp;quot;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
&lt;li&gt;修改redis.conf 配置文件（daemonize yes  后台启动）
&amp;gt; vim redis.conf
&amp;gt; daemonize yes 
&amp;gt; ./bin/redis-server ./redis.conf&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
&lt;p&gt;ps aux | grep redis
./bin/redis-cli INFO&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
&lt;li&gt;可以对redis 进行检测
&amp;gt; cd /usr/local/redis/bin
&amp;gt; ./redis-benchmark -t GET,SET&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;当然，也可以添加 -q 对输出结果进行精简&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;./redis-benchmark -q -t GET,SET&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;编译安装完成&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;安装PHP对redis的扩展 （Cannot find config.m4. 解决方案：进入扩展目录）
下载地址：http://pecl.php.net/package/redis&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;解压文件&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;cd phpredis-2.2.4
/usr/local/php/bin/phpize
./configure --with-php-config=/usr/local/php/bin/php-config
make
make install&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;将生成的 memcache.so 动态库的目录添加到php.ini文件里面&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;vim /usr/local/php/etc/php.ini
extension_dir = &amp;quot;/usr/local/php/lib/php/extensions/no-debug-non-zts-20090626&amp;quot;
extension=redis.so&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;到网站根目录添加测试文件 redis.php&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;cd /var/www/html
vim redis.php&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;lineno&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;?&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;nv&quot;&gt;$redis&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Redis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;nv&quot;&gt;$redis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;localhost&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6379&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;4&lt;/span&gt;         &lt;span class=&quot;nv&quot;&gt;$redis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;hello world&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;5&lt;/span&gt;         &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$redis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;test&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;6&lt;/span&gt;     &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;在浏览器的地址栏输入 http://localhost/memcache.php输入上述地址后 浏览器页面 输出 hello world ，则成功&lt;/li&gt;
&lt;/ul&gt;
</description>
      </item>
    
      <item>
        <title>lamp环境的搭建</title>
        <link>http://杨柳青一些事.中国/2015/03/25/linux-lamp.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2015/03/25/linux-lamp.html</guid>
        <pubDate>Wed, 25 Mar 2015 00:00:00 +0800</pubDate>
        <description>&lt;h1&gt;lamp环境的搭建&lt;/h1&gt;

&lt;p&gt;lamp源码包：&lt;a href=&quot;http://yunpan.cn/cHqsvIUPRgEgN&quot;&gt;http://yunpan.cn/cHqsvIUPRgEgN&lt;/a&gt;  访问密码 ca46 &lt;br/&gt;
linux操作系统：&lt;a href=&quot;http://yunpan.cn/cHqsNzJpiSfQf&quot;&gt;http://yunpan.cn/cHqsNzJpiSfQf&lt;/a&gt;  访问密码 9412 &lt;br/&gt;
mysql源码：&lt;a href=&quot;http://mirrors.sohu.com/mysql/&quot;&gt;http://mirrors.sohu.com/mysql/&lt;/a&gt;&lt;br/&gt;
httpd源码：&lt;a href=&quot;http://mirrors.sohu.com/mysql/&quot;&gt;http://apache.fayea.com/httpd/&lt;/a&gt;&lt;br/&gt;
PHP源码：&lt;a href=&quot;http://php.net/releases/&quot;&gt;http://php.net/releases/&lt;/a&gt;&lt;br/&gt;&lt;/p&gt;

&lt;h2&gt;系统环境查看&lt;/h2&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&amp;gt; [root@asion ~]#   lsb_release  -a
LSB-Version:core-4.0-ia32:core-4.0-noarch:graphics-4.0-ia32:gr  aphics-4.0-noarch:printing-4.0-ia32:printing-4.0-noarch
Distributor ID:  CentOS
Description:    CentOS release 5.5 (Final)
Release:        5.5
Codename:      Final
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;编译环境的准备 (在编译之前，先安装好相应的编译器和库文件等)&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;yum -y install make apr* autoconf automake curl-devel gcc gcc-c++ zlib-devel openssl openssl-devel pcre-devel gd kernel keyutils patch perl kernel-headers compat* mpfr cpp glibc libgomp libstdc++-devel ppl cloog-ppl keyutils-libs-devel libcom_err-devel libsepol-devel libselinux-devel krb5-devel zlib-devel libXpm* freetype libjpeg* libpng* php-common php-gd ncurses* libtool* libxml2 libxml2-devel patch cmake&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ftp环境的搭建（使用  非root  用户后，在ftp客户端上传相关的源码）
    &amp;gt; yum install -y vsftpd
    &amp;gt; useradd asion
    &amp;gt; service vsftpd status&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;下载相关的源码包(将源码cp到/usr/local/src/下，并进入)
    &amp;gt; cd /usr/local/src/
    &amp;gt; pwd&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;解压相关源码文件
    &amp;gt; tar -zxvf xxx.tar.gz&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;进入解压后的文件夹
    &amp;gt; cd xxx
    &amp;gt; ./configure --help
    &amp;gt; make
    &amp;gt; make install&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;安装成功后，在网站目录创建index.php文件，写入phpinfo()测试
    &amp;gt; touch index.php
    &amp;gt; echo &amp;#39;&amp;lt;?php phpinfo();&amp;gt;&amp;#39;  &amp;gt; index.php&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;具体安装&lt;/p&gt;

&lt;p&gt;a. libxml2 安装（xml和html文件相关依赖的库）
    &amp;gt; tar -zxvf libxml2-2.6.30
    &amp;gt; cd libxml2-2.6.30
    &amp;gt; ./configure --prefix=/usr/local/libxml2
    &amp;gt; make &amp;amp;&amp;amp; make install&lt;/p&gt;

&lt;p&gt;b. libmcrypt-2.5.8 安装（加密库）
    &amp;gt; cd /lamp/libmcrypt-2.5.8
    &amp;gt; ./configure --prefix=/usr/local/libmcrypt/
    &amp;gt; make 
    &amp;gt; make install&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;== 进入libmcrypt-2.5.8文件夹内的 libltdl
&amp;gt; cd ./libmcrypt-2.5.8/libltdl
&amp;gt; ./configure --enable-ltdl-install
&amp;gt; make
&amp;gt; make install
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;c. zlib库安装（不需要指定安装路径）
    &amp;gt; ./configure
    &amp;gt; make
    &amp;gt; make install &lt;/p&gt;

&lt;p&gt;d. png图片库安装
    &amp;gt; ./configure --prefix=/usr/local/libpng/
    &amp;gt; make
    &amp;gt; make install&lt;/p&gt;

&lt;p&gt;e. jpeg图片库安装（需要自己创建jpeg6）
    &amp;gt; mkdir /usr/local/jpeg6
    &amp;gt; mkdir /usr/local/jpeg6/bin
    &amp;gt; mkdir /usr/local/jpeg6/lib
    &amp;gt; mkdir /usr/local/jpeg6/include
    &amp;gt; mkdir -p /usr/local/jpeg6/man/man1
    &amp;gt; cd /lamp/jpeg-6b
    &amp;gt; ./configure --prefix=/usr/local/jpeg6/ --enable-shared --enable-static
    &amp;gt; make
    &amp;gt; make install&lt;/p&gt;

&lt;p&gt;f. freetype字体库安装
    &amp;gt; ./configure --prefix=/usr/local/freetype/
    &amp;gt; make
    &amp;gt; make install&lt;/p&gt;

&lt;p&gt;g. autoconfig生成makefile安装（不需要指定安装路径）
    &amp;gt; ./configure
    &amp;gt; make 
    &amp;gt; make install&lt;/p&gt;

&lt;p&gt;h. GD 库的安装
    &amp;gt; ./configure --prefix=/usr/local/gd2/ --with-jpeg=/usr/local/jpeg6/ --with-freetype=/usr/local/freetype/ --enable-m4&lt;em&gt;pattern&lt;/em&gt;allow 
    &amp;gt; make
    &amp;gt; make install&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;注意：当make的时候，出现以下错误 
configure.ac:64: error: possibly undefined macro: AM_ICONV 
If this token and others are legitimate, please use m4_pattern_allow. 
See the Autoconf documentation. 
make: *** [configure] Error 1 

解决方案：
解决办法 ，编译加m4_pattern_allow参数 
即：./configure --enable-m4_pattern_allow 
便能顺利编译安装
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;i. apache安装&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;./configure --prefix=/usr/local/apache2  --sysconfdir=/etc/httpd/ --enable-rewrite --enable-so --enable-headers --enable-expires  --enable-modules=most --enable-deflate&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;j. ncurses安装(Mysql安装前必须安装这个字符库)源码安装才需要)&lt;/p&gt;

&lt;p&gt;k. 安装mysql通用二进制包
    &amp;gt;  groupadd mysql
    &amp;gt;  useradd -g mysql mysql&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&amp;gt;  cd /usr/local/mysql-5.5.44-linux2.6-i686/
&amp;gt;  chown -R msyql.mysql  .
&amp;gt;  scripts/mysql_install_db --basedir=/usr/local/mysql  --user=mysql
&amp;gt;  chown -R root .
&amp;gt;  cp support-files/mysql.server /etc/init.d/mysqld

&amp;gt;  chkconfig --add mysqld
&amp;gt;  chkconfig mysqld on
&amp;gt;  cp support-files/my-medium.cnf /etc/my.cnf

&amp;gt;  service mysqld start
&amp;gt;  ps aux | grep mysqld  

注意：/usr/local/mysql/bin/mysqld: error while loading shared libraries: libaio.so.1: cannot open shared object file: No such file or directory

解决方案：libaio.i386 0:0.3.106-5
&amp;gt; yum install libaio

注意： selinux 必须关闭
&amp;gt; sestatus -v
&amp;gt; getenforce

&amp;gt; 临时关闭
&amp;gt; setenforce 0

&amp;gt; 修改配置文件需要重启机器：
&amp;gt; 修改/etc/selinux/config 文件
&amp;gt; 将SELINUX=enforcing改为SELINUX=disabled
&amp;gt; 重启机器即可 

注意：
[root@localhost mysql]# service mysql start
Starting MySQL.. ERROR! The server quit without updating PID file (/var/lib/mysql/localhost.localdomain.pid).

解决方案：
    1. 注释/etc/my.cnf里的skip-federated注释掉即#skip-federated；
    2. my.cnf文件配置过高，重新定义其中的参数（根据服务器情况定义）；
    3. 杀掉mysql_safe和mysqld进程，然后再重启；
    4. 当前日志文件过大，超出了my.cnf中定义的大小（默认为64M），删除日志文件再重启；
    5. 其他情况，查看日志文件（本人是/usr/local/data/bogon.error，具体因人而异），然后具体分析；
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;l. 安装PHP
      &amp;gt; cd /usr/local/src/php-5.3.28
      &amp;gt; ./configure --prefix=/usr/local/php/ --with-config-file-path=/usr/local/php/etc/ --with-apxs2=/usr/local/apache2/bin/apxs --with-mysql=/usr/local/mysql/ --with-libxml-dir=/usr/local/libxml2/ --with-jpeg-dir=/usr/local/jpeg6/ --with-freetype-dir=/usr/local/freetype/ --with-gd=/usr/local/gd2/ --with-mcrypt=/usr/local/libmcrypt/ --with-mysqli=/usr/local/mysql/bin/mysql_config --enable-soap --enable-mbstring=all --enable-sockets 
      &amp;gt;  make
      &amp;gt;  make install
      &amp;gt;  cp php.ini-dist /usr/local/php/etc/php.ini&lt;/p&gt;

&lt;p&gt;m. 打开Apache的配置文件（添加AddType这两行）&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;cd /etc/httpd/
vim httpd.conf
AddType application/x-httpd-php .php
AddType application/x-httpd-source .phps&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;n. 更改php.ini里面的时区（设置为亚洲/上海）
    &amp;gt; cd /usr/local/php/etc/
    &amp;gt; vim php.ini
    &amp;gt; date.timezone = Asia/Shanghai&lt;/p&gt;

&lt;p&gt;o. 在网站根目录建立测试文件
    &amp;gt; cd /var/www/html
    &amp;gt; vim index.php
    &amp;gt; phpinfo()&lt;/p&gt;

&lt;p&gt;p. 在浏览器地址栏输入 http://localhost/index.php&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
      </item>
    
      <item>
        <title>URI、URL和URN三者之间的区别</title>
        <link>http://杨柳青一些事.中国/2015/03/12/URI-URL-URN.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2015/03/12/URI-URL-URN.html</guid>
        <pubDate>Thu, 12 Mar 2015 00:00:00 +0800</pubDate>
        <description>&lt;p&gt;这是一个经典的技术争论，许多人都会自问：URL、URI，很可能还有URN，它们之间的区别是什么。虽然，现在我们简单地把 URN 和 URL 都看做 URI，但严格来说URI可以进一步划分为URL、URN或者这两者的组合，所以了解这三者之间的区别将会非常有趣并让人受益匪浅。如果你恰好在某个地方碰到了这些东西，那么至少应该知道它们的含义。&lt;/p&gt;

&lt;hr&gt;

&lt;h3&gt;&lt;strong&gt;definition&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;这三个缩略词是Tim Berners-Lee在一篇名为RFC 3986: Uniform Resource Identifier (URI): Generic Syntax的文档中定义的互联网标准追踪协议。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;URI&lt;/strong&gt;，是&lt;code&gt;uniform resource identifier&lt;/code&gt;，统一资源标识符，用来唯一的标识一个资源。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;URL&lt;/strong&gt;,是&lt;code&gt;uniform resource locator&lt;/code&gt;，统一资源定位器，它是一种具体的URI，即URL可以用来标识一个资源，而且还指明了如何locate这个资源。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;URN&lt;/strong&gt;,是&lt;code&gt;uniform resource name&lt;/code&gt;，统一资源命名，是通过名字来标识资源。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;区别&lt;/h2&gt;

&lt;p&gt;首先我们要弄清楚一件事：URL和URN都是URI的子集。&lt;/p&gt;

&lt;p&gt;换言之，URL和URN都是URI，但是URI不一定是URL或者URN。为了更好的理解这个概念，看下面这张图片。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/public/img/technology/URI-URL-URN.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;

&lt;p&gt;通过下面的例子（源自 Wikipedia），我们可以很好地理解URN 和 URL之间的区别。如果是一个人，我们会想到他的姓名和住址。&lt;/p&gt;

&lt;p&gt;URL类似于住址，它告诉你一种寻找目标的方式（在这个例子中，是通过街道地址找到一个人）。要知道，上述定义同时也是一个URI。&lt;/p&gt;

&lt;p&gt;相对地，我们可以把一个人的名字看作是URN；因此可以用URN来唯一标识一个实体。由于可能存在同名（姓氏也相同）的情况，所以更准确地说，人名这个例子并不是十分恰当。更为恰当的是书籍的ISBN码和产品在系统内的序列号，尽管没有告诉你用什么方式或者到什么地方去找到目标，但是你有足够的信息来检索到它。&lt;/p&gt;

&lt;h2&gt;一个用于理解这三者的例子&lt;/h2&gt;

&lt;p&gt;我们来看一下上述概念如何应用于与我们息息相关的互联网。&lt;/p&gt;

&lt;p&gt;再次引用Wikipedia ，这些引文给出的解释，比上面人员地址的例子更为专业：&lt;/p&gt;

&lt;p&gt;关于URL：&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;URL是URI的一种，不仅标识了Web 资源，还指定了操作或者获取方式，同时指出了主要访问机制和网络位置。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;关于URN：&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;URN是URI的一种，用特定命名空间的名字标识资源。使用URN可以在不知道其网络位置及访问方式的情况下讨论资源。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;现在，如果到Web上去看一下，你会找出很多例子，这比其他东西更容易让人困惑。我只展示一个例子，非常简单清楚地告诉你在互联网中URI 、URL和URN之间的不同。&lt;/p&gt;

&lt;p&gt;我们一起来看下面这个虚构的例子。这是一个URI：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;http://test.com/posts/hello.html#intro
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我们开始分析&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;http://
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;是&lt;code&gt;定义如何访问资源的方式&lt;/code&gt;。另外&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;test.com/posts/hello.html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;是&lt;code&gt;资源存放的位置&lt;/code&gt;，那么，在这个例子中，&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;#intro
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;是&lt;code&gt;资源&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;URL是URI的一个子集，告诉我们&lt;code&gt;访问网络位置的方式&lt;/code&gt;。在我们的例子中，URL应该如下所示：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;http://test.com/posts/hello.html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;URN是URI的子集，包括&lt;code&gt;名字&lt;/code&gt;（给定的命名空间内），但是&lt;code&gt;不包括访问方式&lt;/code&gt;，如下所示：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;test.com/posts/hello.html#intro
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;就是这样。现在你应该能够辨别出URL和URN之间的不同。&lt;/p&gt;

&lt;p&gt;如果你忘记了这篇文章的内容，至少要记住一件事：&lt;code&gt;URI可以被分为URL、URN或两者的组合&lt;/code&gt;。如果你一直使用URI这个术语，就不会有错。&lt;/p&gt;
</description>
      </item>
    
      <item>
        <title>Linux下 nginx安装 + php-fpm安装</title>
        <link>http://杨柳青一些事.中国/2015/03/11/Lnmp.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2015/03/11/Lnmp.html</guid>
        <pubDate>Wed, 11 Mar 2015 00:00:00 +0800</pubDate>
        <description>&lt;h1&gt;Linux下 nginx安装 + php-fpm安装&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;编译环境准备&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;yum -y install gcc automake autoconf libtool make  gcc  gcc-c++&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;一般都需要先装pcre、 zlib，前者为了重写rewrite，后者为了gzip压缩
源代码目录：/usr/local/src&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;安装pcre 和 zlib 和 ssl&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;cd /usr/local/src
wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.34.tar.gz 
tar -zxvf pcre-8.34.tar.gz
cd pcre-8.34
./configure
make
make install&lt;/p&gt;

&lt;p&gt;cd /usr/local/src
wget http://zlib.net/zlib-1.2.8.tar.gz
tar -zxvf zlib-1.2.8.tar.gz
cd zlib-1.2.8
./configure
make
make install&lt;/p&gt;

&lt;p&gt;cd /usr/local/src
wget http://www.openssl.org/source/openssl-1.0.1c.tar.gz
tar -zxvf openssl-1.0.1c.tar.gz&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;nginx 安装&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;cd /usr/local/src
wget http://nginx.org/download/nginx-1.4.2.tar.gz
tar -zxvf nginx-1.4.2.tar.gz
cd nginx-1.4.2&lt;/p&gt;

&lt;p&gt;./configure --sbin-path=/usr/local/nginx/nginx  \
--conf-path=/usr/local/nginx/nginx.conf  \
--pid-path=/usr/local/nginx/nginx.pid&lt;/p&gt;

&lt;p&gt;make
make install&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;安装成功后，/usr/local/nginx 目录下如下
fastcgi.conf            koi-win             nginx.conf.default
fastcgi.conf.default    logs                scgi&lt;em&gt;params
fastcgi&lt;/em&gt;params          mime.types          scgi&lt;em&gt;params.default
fastcgi&lt;/em&gt;params.default  mime.types.default  uwsgi&lt;em&gt;params
html                    nginx               uwsgi&lt;/em&gt;params.default
koi-utf                 nginx.conf          win-utf&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;启动之前先确保 80 端口没有被占用，执行 /usr/local/nginx/nginx 启动&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;netstat -an | grep 80&lt;/p&gt;

&lt;p&gt;lsof -i | grep 80&lt;/p&gt;

&lt;p&gt;netstat -tunpl | grep 80&lt;/p&gt;

&lt;p&gt;/usr/local/nginx/nginx&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;fpm-php 安装(5.3.3之后默认自带 加上参数 --enable-fpm 开启)&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;tar -zxvf php-5.3.28.tar.gz&lt;/p&gt;

&lt;p&gt;cd php-5.3.28&lt;/p&gt;

&lt;p&gt;./configure --prefix=/usr/local/php  --enable-fpm &lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;更改nginx的配置文件 nginx.conf ，增加，并增加php-fpm的配置文件&lt;/p&gt;

&lt;p&gt;location ~ .php$ {
    root html;
    fastcgi&lt;em&gt;pass 127.0.0.1:9000;
    fastcgi&lt;/em&gt;index index.php;
    fastcgi&lt;em&gt;param SCRIPT&lt;/em&gt;FILENAME $document&lt;em&gt;root$fastcgi&lt;/em&gt;script&lt;em&gt;name;
    include fastcgi&lt;/em&gt;params;
}&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;cd /usr/local/phpfpm/etc&lt;/p&gt;

&lt;p&gt;cp php-fpm.conf.default php-fpm.conf&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;将 fpm-php 加入系统服务 (/usr/local/src/php-5.3.28/ )，并启动&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;cp ./sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm&lt;/p&gt;

&lt;p&gt;chmod +x /etc/init.d/php-fpm&lt;/p&gt;

&lt;p&gt;chkconfig --add php-fpm&lt;/p&gt;

&lt;p&gt;chkconfig php-fpm on&lt;/p&gt;

&lt;p&gt;service php-fpm start&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;使用 phpinfo() 函数测试即可&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;附：
I. 在编译安装时候可能遇到的一些问题
    a. 编译pcre错误
    libtool: compile: unrecognized option &lt;code&gt;-DHAVE_CONFIG_H&amp;#39;
    libtool: compile: Try&lt;/code&gt;libtool --help&amp;#39; for more information.
    make[1]: *** [pcrecpp.lo] Error 1
    make[1]: Leaving directory `/usr/local/src/pcre-8.34&amp;#39;
    make: *** [all] Error 2&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;解决方案：

&amp;gt; yum install -y g++

make 时候出错

解决方案：
&amp;gt; yum -y install openssl openssl-devel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;II. nginx编译选项&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;a. configure命令是用来检测你的安装平台的目标特征的。它定义了系统的各个方面，包括nginx的被允许使用的连接处理的方法，比如它会检测你是不是有CC或GCC，并不是需要CC或GCC，它是个shell脚本，执行结束时，它会创建一个Makefile文件

b. make是用来编译的，它从Makefile中读取指令，然后编译

c. make install是用来安装的，它也从Makefile中读取指令，安装到指定的位置

nginx的configure命令支持以下参数：

    --prefix=PATH  定义一个安装目录，也就是nginx的安装目录。默认使用 /usr/local/nginx

    --sbin-path=PATH 设置nginx的可执行文件的路径，默认为  prefix/sbin/nginx

    --conf-path=PATH  设置在nginx.conf配置文件的路径。nginx允许使用不同的配置文件启动，通过命令行中的-c选项。默认为prefix/conf/nginx.conf

    --pid-path=PATH  设置nginx.pid文件，将存储的主进程的进程号。安装完成后，可以随时改变的文件名 ， 在nginx.conf配置文件中使用 PID指令。默认情况下，文件名 为prefix/logs/nginx.pid

    --error-log-path=PATH 设置主错误，警告，和诊断文件的名称。安装完成后，可以随时改变的文件名 ，在nginx.conf配置文件中 使用 的error_log指令。默认情况下，文件名 为prefix/logs/error.log

    --http-log-path=PATH 设置主请求的HTTP服务器的日志文件的名称。安装完成后，可以随时改变的文件名 ，在nginx.conf配置文件中 使用 的access_log指令。默认情况下，文件名 为prefix/logs/access.log

    --user=name 设置nginx工作进程的用户，默认的用户名是nobody

    --group=name  设置nginx工作进程的用户组。安装完成后，可以随时更改的名称在nginx.conf配置文件中 使用的 user指令。默认的为非特权用户。

    --with-select_module --without-select_module 启用或禁用构建一个模块来允许服务器使用select()方法。该模块将自动建立，如果平台不支持的kqueue，epoll，rtsig或/dev/poll

    --with-poll_module --without-poll_module 启用或禁用构建一个模块来允许服务器使用poll()方法。该模块将自动建立，如果平台不支持的kqueue，epoll，rtsig或/dev/poll

    --without-http_gzip_module 不编译压缩的HTTP服务器的响应模块。编译并运行此模块需要zlib库

    --without-http_rewrite_module 不编译重写模块。编译并运行此模块需要PCRE库支持

    --without-http_proxy_module 不编译http_proxy模块

    --with-http_ssl_module  使用https协议模块。默认情况下，该模块没有被构建。建立并运行此模块的OpenSSL库是必需的

    --with-pcre=PATH 设置PCRE库的源码路径。PCRE库的源码（版本4.4 - 8.30）需要从PCRE网站下载并解压。其余的工作是Nginx的./ configure和make来完成。正则表达式使用在location指令和 ngx_http_rewrite_module 模块中

    --with-pcre-jit 编译PCRE包含just-in-time compilation”（1.1.12中， pcre_jit指令）

    --with-zlib=PATH 设置的zlib库的源码路径。要下载从 zlib（版本1.1.3 - 1.2.5）的并解压。其余的工作是Nginx的./ configure和make完成。ngx_http_gzip_module模块需要使用zlib 

    --with-cc-opt=parameters
     设置额外的参数将被添加到CFLAGS变量。例如,当你在FreeBSD上使用PCRE库时需要使用:--with-cc-opt=&amp;quot;-I /usr/local/include。.如需要需要增加 select()支持的文件数量:--with-cc-opt=&amp;quot;-D FD_SETSIZE=2048&amp;quot;

    --with-ld-opt=parameters 设置附加的参数，将用于在链接期间。例如，当在FreeBSD下使用该系统的PCRE库,应指定:--with-ld-opt=&amp;quot;-L /usr/local/lib&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Status API Training Shop Blog About Pricing
© 2015 GitHub, Inc. Terms Privacy Security Contact Help&lt;/p&gt;
</description>
      </item>
    
      <item>
        <title>linux 环境下 php 扩展安装通用方法</title>
        <link>http://杨柳青一些事.中国/2015/02/20/linux-php.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2015/02/20/linux-php.html</guid>
        <pubDate>Fri, 20 Feb 2015 00:00:00 +0800</pubDate>
        <description>&lt;h1&gt;linux 环境下 php 扩展安装通用方法&lt;/h1&gt;

&lt;p&gt;(本案例拿 php的mbstring 来做演示)
1. 首先进入到php源码包中的 ext 目录下 &lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&amp;gt; /usr/local/src/php-5.3.28/ext/mbstring
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;在mbstring 目录下(/usr/local/src/php-5.3.28/ext/mbstring 目录下)产生configure文件，执行如下命令&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;/usr/local/php/bin/phpize&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;配置编译(/usr/local/src/php-5.3.28/ext/mbstring 目录下) &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;./configure --with-php-config=/usr/local/php/bin/php-config &lt;/p&gt;

&lt;p&gt;make &amp;amp;&amp;amp; make install &lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在执行上面命令后会生成一个目录DIR(/usr/local/php/lib/php/extensions/no-debug-non-zts-20090626)，里面包含 mbstring.so 文件&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;配置 php.ini 文件中的extension_dir=DIR ，然后加入一行  extension=mbstring.so&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;extension_dir=&amp;quot;/usr/local/php/lib/php/extensions/no-debug-non-zts-20090626&amp;quot;&lt;/p&gt;

&lt;p&gt;extension=mbstring.so&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;使用 phpinfo() 函数测试 &lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;注意：安装php的mcrypt时候出现问题？&lt;/p&gt;

&lt;p&gt;问题描述：在php对mcrypt的扩展时候，出现mcrypt.h not found. Please reinstall libmcrypt&lt;/p&gt;

&lt;p&gt;解决方案：
- 使用第三方的yum源来解决&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;wget http://www.atomicorp.com/installers/atomic&lt;/p&gt;

&lt;p&gt;sh ./atomic  &lt;/p&gt;

&lt;p&gt;yum  install  php-mcrypt  libmcrypt  libmcrypt-devel&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
&lt;li&gt;使用php mcrypt 前必须先安装libmcrypt&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;libmcrypt源码安装方法：&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;cd /usr/local/src&lt;/p&gt;

&lt;p&gt;wget http://softlayer.dl.sourceforge.net/sourceforge/mcrypt/libmcrypt-2.5.8.tar.gz&lt;/p&gt;

&lt;p&gt;tar -zxvf libmcrypt-2.5.8.tar.gz&lt;/p&gt;

&lt;p&gt;cd /usr/local/src/libmcrypt-2.5.8&lt;/p&gt;

&lt;p&gt;./configure --prefix=/usr/local&lt;/p&gt;

&lt;p&gt;make&lt;/p&gt;

&lt;p&gt;make install&lt;/p&gt;
&lt;/blockquote&gt;
</description>
      </item>
    
      <item>
        <title>Nginx</title>
        <link>http://杨柳青一些事.中国/2015/01/16/Nginx.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2015/01/16/Nginx.html</guid>
        <pubDate>Fri, 16 Jan 2015 00:00:00 +0800</pubDate>
        <description>&lt;p&gt;简单学习下nginx&lt;/p&gt;

&lt;hr&gt;

&lt;h3&gt;&lt;strong&gt;常用web服务器的介绍&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;apache&lt;/strong&gt;:功能完善，历史悠久 &lt;/p&gt;

&lt;p&gt;缺点：处理每一个php比较费资源，导致如果高并发时会太耗费服务器资源无法处理更多请求。 &lt;/p&gt;

&lt;p&gt;&lt;strong&gt;nginx&lt;/strong&gt;：省资源，省cpu,所以在高并发时能够处理更多的请求，高端能达到3万到5万的并发量。 &lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;nginx的了解&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;Nginx（”engine x”）是俄罗斯人编写的一款高性能的HTTP和反向代理服务器。Nginx是Apache服务器不错的替代品，它能够支持高达50000个并发连接数的响应，而内存，cpu等系统资源消耗却非常低，运行非常稳定。 &lt;/p&gt;

&lt;p&gt;在国内，已经有新浪博客，新浪播客，网易新闻，六间房，56.com,discuz!等多家网站使用Nginx作为web服务器或反向代理服务器。&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;nginx特点&lt;/strong&gt;&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;可以高并发连接，官方测试能够支撑5万并发连接，在实际生产环境中可以支撑2到4万并发连接。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;内存消耗少&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Nginx+php(FastCGI)服务器再3万并发连接下，开启的10个Nginx进程消耗150MB内存（15MB&lt;em&gt;10=150MB）开启的64个php-cgi进程消耗1280MB内存（20MB&lt;/em&gt;64=1280MB） &lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;成本低廉 &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;购买F5 BIG-IP ,NetScaler等硬件负载均衡交换机需要10多万甚至几十万人民币。而Nginx为开源软件，可以免费试用，并且可用于商业用途。 &lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;其他理由： &lt;/li&gt;
&lt;/ul&gt;

&lt;ol&gt;
&lt;li&gt;配置文件非常简单：通俗易懂，即使非专业管理员也能看懂。 &lt;/li&gt;
&lt;li&gt;支持 rewrite重写规则：能根据域名、URL的不同，将HTTP请求分到不同的后端服务器群组。 &lt;/li&gt;
&lt;li&gt;内置的健康检查功能：如果nginx proxy后端的某台服务器宕机了，不会影响前端访问。 &lt;/li&gt;
&lt;li&gt;节省带宽，支持gzip压缩。 &lt;/li&gt;
&lt;li&gt;稳定性高：用于反向代理，宕机的概率微乎其微。 &lt;/li&gt;
&lt;li&gt;支持热部署。在不间断服务的情况下，对软件版本升级。&lt;/li&gt;
&lt;/ol&gt;

&lt;h3&gt;&lt;strong&gt;支持的操作系统&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;FreeBSD 3.x,4.x,5.x,6.x i386; FreeBSD 5.x,6.x amd64;&lt;/p&gt;

&lt;p&gt;Linux 2.2,2.4,2.6 i386; Linux 2.6 amd64;&lt;/p&gt;

&lt;p&gt;Solaris 8 i386; Solaris 9 i386 and sun4u; Solaris 10 i386;&lt;/p&gt;

&lt;p&gt;MacOS X （10.4） PPC;&lt;/p&gt;

&lt;p&gt;Windows XP，Windows Server 2003和Windows 7&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;nginx 的安装，（window下面的安装）&lt;/strong&gt;&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;解压软件，并拷贝到指定的目录&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;黑窗口进入到nginx命令所在的目录，执行&lt;code&gt;start nginx&lt;/code&gt;命令即可&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;可以查看是否启动成功,执行&lt;code&gt;netstat -an&lt;/code&gt;命令查看80端口是否开启&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;浏览器进入localhost看是否出现&lt;code&gt;welcome to nginx&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;打完收工-.-真的好简单&lt;/p&gt;

&lt;h3&gt;关于nginx的一些命令&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;start nginx//启动nginx服务。 
nginx -s stop // 停止nginx
nginx -s reload // 重新加载配置文件，无需重启 nginx服务器。
nginx -s quit // 退出nginx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;&lt;strong&gt;虚拟主机的配置&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;简单观察下,发现一个server就是一个虚拟主机则配置如下&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;server{
        listen       80;                #端口号
        server_name  www.lalala.com;    #域名
        location / {
            root    lalala;             #网站根目录
            index index.html index.htm; 
        }
    }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这只是简单的虚拟主机,并不能解析php文件,并且别忘了配置完成后执行&lt;code&gt;nginx -s reload&lt;/code&gt;重新加载配置文件&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;配置nginx支持PHP&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;在nginx中，php不是作为一个模块出现在nginx里面。php是作为一个独立进程运行的。该进程的端口是9000端口。当nginx遇到php文件时，交给9000端口来处理。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;配置php加载扩展文件的位置&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;;设置mysql路径
 extension_dir = &amp;quot;F:\PHP\ext&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;配置时区&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;date.timezone = PRC
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;配置让php 作为独立进程运行&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;;让php作为独立进程运行
cgi.fix_pathinfo=1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;打开nginx.conf的配置文件,把如下代码解除封印&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;location ~ \.php$ {
            root           lalala;          #网站根目录
            fastcgi_pass   127.0.0.1:9000;
            fastcgi_index  index.php;
            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
            include        fastcgi_params;
        }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;重启下nginx,也可以查看是否启动成功,执行&lt;code&gt;netstat -an&lt;/code&gt;命令查看80端口与9000端口是否开启&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;phpinfo()函数测试下是否成功吧-.-&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;&lt;strong&gt;配置nginx expires缓存功能&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;对于图片，css,js等元素更改机会较少，特别是图片，可以将图片设置在浏览器本地缓存365天，css,js缓存10天，这样可以提高下次打开用户页面加载速度，并节省大量带宽。此功能同apache的expires。这里通过location的功能，将需要缓存的扩展名列出来，然后指定缓存时间：&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;location  ~.*\.(gif|jpg|jpeg|png|bmp)$
{   
    root abc;
    expires 365d;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;&lt;strong&gt;配置压缩&lt;/strong&gt;&lt;/h3&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;gzip on;  
#开启gzip压缩功能
gzip_min_length 1k;
#设置允许压缩的页面最小字节数，页面字节数从header头的content-length中获取。默认值是0,不管页面多大都进行压缩。建议设置成大于1k。如果小于1k可能会越压越大。
gzip_buffers 4 16k;
#压缩缓冲区大小。表示申请4个单位为16k的内容作为压缩结果流缓存，默认值是申请与原始数据大小相同的内存空间来存储gzip压缩结果。
gzip_http_version 1.0;
#压缩版本（默认1.1，前端为squid2.5时使用1.0）用于设置识别http协议版本，默认是1.1,目前大部分浏览器已经支持gzip解压，使用默认即可。
gzip_comp_level 6;
#压缩比率。用来指定gzip压缩比，1压缩比量小，处理速度快；9压缩比量大，传输速度快，但处理最慢，也必将消耗cpu资源。
gzip_types text/plain application/x-javascript text/css application/xml;
#用来指定压缩的类型，“text/html”类型总是会被压缩。
gzip_vary on;
#vary header支持。该选项可以让前端的缓存服务器缓存经过gzip压缩的页面，例如用squid缓存经过nginx压缩的数据。
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意：不要对视频和图片配置压缩，对视频和图片压缩比较费资源，而且压缩效果不好。主要压缩对象是文本类型文件。&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;配置负载均衡&lt;/strong&gt;&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;使用基于端口的虚拟主机可以配置模拟多台服务器：&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    server {
        listen 81;
        server_name www.abc.com;
        location / {
            root 81;
            index index.html index.htm;
        }
    }
    server {
        listen 82;
        server_name www.abc.com;
        location / {
            root 82;
            index index.html index.htm;
        }
    }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;在nginx目录下面新建81和82的两个目录，并在两个目录里面分别新建两个文件，该两个文件的内容不要一样&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;建立一个连接池&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;upstream  nihao {
        server www.123.com:81;
        server www.123.com:82;
    }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;配置一个域名为www.123.com的虚拟主机&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;server {
        listen 80;
        server_name www.123.com;
        location /{
            proxy_pass http://nihao; #连接池名字
            proxy_set_header Host $host;
            proxy_set_header X-Peal-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        }
    }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;配置好hosts文件就可以开心的轮询了- -&lt;/li&gt;
&lt;/ul&gt;
</description>
      </item>
    
      <item>
        <title>Mysql主从复制</title>
        <link>http://杨柳青一些事.中国/2014/08/21/Replication.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2014/08/21/Replication.html</guid>
        <pubDate>Thu, 21 Aug 2014 00:00:00 +0800</pubDate>
        <description>&lt;p&gt;为了减少数据库的压力,我们通常配置多个数据库,把增删改语句放在主数据库中操作,查询放在从数据库中操作&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;什么是主从复制&lt;/strong&gt;&lt;/h3&gt;

&lt;h3&gt;&lt;strong&gt;主从复制实现原理&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;原理&lt;/strong&gt;:mysql有一种日志,叫做&lt;code&gt;log-bin&lt;/code&gt;日志(二进制日志),它会记录下所有修改过数据库的sql语句,&lt;strong&gt;主从复制&lt;/strong&gt;实际上是多台服务器都开启log-bin日志,主服务器会把sql语句保存到log-bin日志中,主服务器更新log-bin日志后会告知从服务器,从服务器通过主服务器grant授权的用户查询主服务器的log-bin日志,并把日志文件里的sql语句执行一遍,则实现了数据同步&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;如何授权一个用户&lt;/strong&gt;&lt;/h3&gt;

&lt;h4&gt;&lt;code&gt;mysql添加账号&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;语法：grant 权限  on  指定数据库和表   to “用户名”@’可以登录主机的ip地址’  identified by ‘密码’&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;grant all  on *.* to ‘lalala’@’%’  identified by ‘papapa’;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;&lt;code&gt;mysql删除账号&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;语法：drop user ‘用户名’@’授权登录主机的ip地址’&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;drop user ‘lalala’@’%’
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;&lt;strong&gt;log-bin日志&lt;/strong&gt;&lt;/h3&gt;

&lt;h4&gt;&lt;code&gt;1 开启log-bin日志&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;打开mysql的配置文件：my.ini(window)     my.cnf  (linux)&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;# 数据库主从复制,mysql-bin 是二进制日志文件的名称,默认是存储数据库文件同一级目录,可以自己指定,比如log-bin=f:/lalala.txt
log-bin=mysql-bin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;之后重启mysql服务，会产生新的一个日志文件(&lt;code&gt;每次重启都会产生新的&lt;/code&gt;)&lt;/p&gt;

&lt;h4&gt;&lt;code&gt;2 和log-bin日志相关的几个函数&lt;/code&gt;&lt;/h4&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;reset master&lt;br&gt;
清空所有的 log-bin日志，并产生一个新的log-bin日志文件。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;flush logs&lt;br&gt;
产生新的一个log-bin日志文件。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;show master status&lt;br&gt;
查看最新的一个log-bin日志的文件名称，并包含pos位置(&lt;code&gt;记录sql语句在log-bin日志文件中的位置&lt;/code&gt;)&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;/public/img/technology/Replication.png&quot; alt=&quot;1&quot;&gt;&lt;/p&gt;

&lt;p&gt;上图的数字就是pos代表的位置&lt;/p&gt;

&lt;h4&gt;&lt;code&gt;3 查看log-bin日志文件里面的内容&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;使用在mysql的安装目录的bin目录下面的mysqlbinlog.exe命令来完成查看&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;mysqlbinlog   --no-defaults    日志文件的名称（包含全路径）
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;&lt;code&gt;4 完成log-bin日志恢复数据&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;只需要把日志文件里面的sql语句执行一遍，即可完成数据恢复&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;mysqlbinlog --no-defaults 日志文件的名称（路径）| mysql –u用户名 –p密码 数据库的名称
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果想恢复具体位置的sql数据,只需查找记录增删改sql语句在log-bin日志文件中的pos 开始位置和结束位置&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;mysqlbinlog --no-defaults --start-position=”开始位置” --stop-position=”结束的位置” 日志文件的名称（路径）| mysql –u用户名 –p密码 数据库的名称 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;&lt;strong&gt;主从配置&lt;/strong&gt;&lt;/h3&gt;

&lt;h3&gt;主服务器配置流程&lt;/h3&gt;

&lt;h4&gt;&lt;code&gt;1 修改my.ini,添加如下语句&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;log-bin=mysql-bin

server-id=1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;&lt;code&gt;2 重启mysql服务器&lt;/code&gt;&lt;/h4&gt;

&lt;h4&gt;&lt;code&gt;3 授权从服务器读取log-bin日志信息用户&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;grant replication slave on *.* to &amp;#39;lalala&amp;#39;@&amp;#39;%&amp;#39; identified by &amp;#39;lalala&amp;#39;;#replication slave 分配复制的权限
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;&lt;code&gt;4 查看主服务器最新的log-bin日志信息&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;Show master status;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;从服务器配置流程&lt;/h3&gt;

&lt;h4&gt;&lt;code&gt;1 修改my.ini,增加如下配置：&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;log-bin=mysql-bin   #二进制日志文件
server-id=2         #每台服务器id不能一样
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;&lt;code&gt;2 重启mysql服务器&lt;/code&gt;&lt;/h4&gt;

&lt;h4&gt;&lt;code&gt;3 进入到mysql命令行后执行下面命令：&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;    stop slave;         #关闭从服务
    reset slave all;        #删除从服务器的配置
    change master to master_host=&amp;quot;192.168.28.65&amp;quot;,master_user=&amp;quot;lalala&amp;quot;,master_password =&amp;quot;lalala&amp;quot; ,master_log_file=&amp;quot;mysql-bin.000002&amp;quot;,master_log_pos=107； #配置与主服务器的链接
    start slave;            #开启从服务
    show slave status;      #查看主从服务状态是否成功
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code&gt;Slave_IO_Running:Yes&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;此进程负责从服务器从主服务器上读取binlog 日志，并写入从服务器上的中继日志&lt;/p&gt;

&lt;p&gt;&lt;code&gt;Slave_SQL_Running:Yes&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;此进程负责读取并且执行中继日志中的binlog日志&lt;/p&gt;

&lt;p&gt;注：以上两个都为yes则表明成功，只要其中一个进程的状态是no，则表示复制进程停止，错误原因可以从&lt;code&gt;last_error&lt;/code&gt;字段的值中看到。
通过在主服务器上面创建一个新的数据库，并创建一张新表，并添加记录，查看从服务器是否同步来完成测试。
配置完成后，要禁止对从服务器执行增删改的操作。&lt;/p&gt;

&lt;h3&gt;如何撤销从服务器&lt;/h3&gt;

&lt;p&gt;在从服务器上面执行：&lt;/p&gt;

&lt;p&gt;停止从服务器：&lt;code&gt;stop slave;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;删除从服务器的一些配置：&lt;code&gt;reset slave all;&lt;/code&gt;&lt;/p&gt;

&lt;h3&gt;在项目中如何使用主从配置，完成读写分离&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;lineno&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;class  mysql{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  $dbm=主服务器 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  $dbs1=从服务器 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  $dbs2=从服务器 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  public function query(){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  #在query里面进行语句判断，分析连接不同的mysql服务器。如果是增删改的操作，就连接主服务器，如果是查询操作，则随机连接从服务器。&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  }&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;8&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;读写分离在TP框架里面实现&lt;/h3&gt;

&lt;p&gt;修改TP框架项目的配置文件：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;lineno&quot;&gt; 1&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;&amp;#39;DB_DEPLOY_TYPE&amp;#39;=&amp;gt;1,//分布式数据库支持&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;&amp;#39;DB_TYPE&amp;#39;               =&amp;gt; &amp;#39;mysql&amp;#39;,     // 数据库类型&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;&amp;#39;DB_HOST&amp;#39;               =&amp;gt; &amp;#39;localhost,192.168.1.1&amp;#39;, // 服务器地址，多个用逗号隔开，默认第一个是主服务器，其余是从服务器。&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;&amp;#39;DB_NAME&amp;#39;               =&amp;gt; &amp;#39;php,php&amp;#39;,          // 数据库名&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 5&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;&amp;#39;DB_USER&amp;#39;               =&amp;gt; &amp;#39;root,lalala&amp;#39;,      // 用户名&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 6&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;&amp;#39;DB_PWD&amp;#39;                =&amp;gt; &amp;#39;root,lalala&amp;#39;,          // 密码&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 7&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;&amp;#39;DB_PORT&amp;#39;               =&amp;gt; &amp;#39;3306&amp;#39;,        // 端口&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;&amp;#39;DB_PREFIX&amp;#39;             =&amp;gt; &amp;#39;&amp;#39;,&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 9&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;&amp;#39;DB_RW_SEPARATE&amp;#39;=&amp;gt;true,//支持读写分离 &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;&amp;#39;DB_MASTER_NUM&amp;#39;         =&amp;gt;  1, // 读写分离后 主服务器数量&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;11&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;&amp;#39;DB_SLAVE_NO&amp;#39;       =&amp;gt;  &amp;#39;&amp;#39;, // 指定从服务器序号，如果为空，则随机连接从服务器。&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
</description>
      </item>
    
      <item>
        <title>几个简单的排序算法</title>
        <link>http://杨柳青一些事.中国/2014/06/11/Simple%20Algorithm.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2014/06/11/Simple%20Algorithm.html</guid>
        <pubDate>Wed, 11 Jun 2014 00:00:00 +0800</pubDate>
        <description>&lt;blockquote&gt;
&lt;p&gt;&amp;quot;内心强大才是真的强大&amp;quot;---子应该没有曰过 -,-&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;数据结构: 数据存储的方式(存储介质)
算法: 数据运算方式(代码)&lt;/p&gt;

&lt;p&gt;常见的排序算法有四种: &lt;code&gt;冒泡&lt;/code&gt;, &lt;code&gt;插入&lt;/code&gt;,&lt;code&gt;选择&lt;/code&gt;和&lt;code&gt;快速&lt;/code&gt;排序&lt;/p&gt;

&lt;hr&gt;

&lt;h3&gt;&lt;strong&gt;冒泡排序&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;冒泡: bubble&lt;/p&gt;

&lt;p&gt;冒泡排序: 将所有的数据比作一个一个的泡,数据大小代表泡的大小. 泡越大意味着浮力越大,就会最先升上去.&lt;/p&gt;

&lt;p&gt;冒泡原理: 对数组进行多次遍历, 每次遍历都能找出最大的泡(剩余部分),将最大的泡放到数组的最后.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;lineno&quot;&gt; 1&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 3&lt;/span&gt;  &lt;span class=&quot;nv&quot;&gt;$arr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;56&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;//冒泡算法&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 5&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;//外层循环,控制冒泡次数&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 6&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$count&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$arr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 7&lt;/span&gt;      &lt;span class=&quot;c1&quot;&gt;//内层循环:进行交换,冒出当前一轮的最大泡&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8&lt;/span&gt;      &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$count&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 9&lt;/span&gt;          &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$arr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$arr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10&lt;/span&gt;              &lt;span class=&quot;nv&quot;&gt;$temp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$arr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;11&lt;/span&gt;              &lt;span class=&quot;nv&quot;&gt;$arr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$arr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;12&lt;/span&gt;              &lt;span class=&quot;nv&quot;&gt;$arr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$temp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;13&lt;/span&gt;          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;14&lt;/span&gt;      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;15&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;16&lt;/span&gt;  &lt;span class=&quot;nb&quot;&gt;var_dump&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$arr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;分析: 因为后面的是j+1，所以j的比较次数需要总元素个数-1，才能保证j+1不超出下标范围，而已经浮出水面的泡不必再比较，所以需要减掉$i.&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;快速排序&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;快速排序: 排序的速度快,利用递归实现&lt;/p&gt;

&lt;p&gt;递归是用空间换时间(短时间内使用较多的内存来进行运算),更多递归知识见&lt;a href=&quot;http://arrowjustdoit.github.io/2014/06/11/Recursive-Traversal.html&quot;&gt;php递归遍历文件夹&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;快速排序原理&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;从一个数组中取出一个元素&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;将剩余的其他元素挨个与取出的元素进行比较: 如果比当前元素小,存放到一个数组;如果比它大,存放到另外一个数组. 结束以后, 当前的中间元素已经确定其位置.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;但是剩下的两个数组有可能没有排好序: 也需要排序,与父问题一样: 递归点&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;如果数组只有一个元素,说明一定已经排好序,就不需要再调用函数排序: 递归出口&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;lineno&quot;&gt; 1&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;/*&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2&lt;/span&gt; &lt;span class=&quot;x&quot;&gt; * @param1 array $arr 待排序的数组&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3&lt;/span&gt; &lt;span class=&quot;x&quot;&gt; * @return array 排序好的数组&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;*/&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 5&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;function quick_sort($arr){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 6&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //取出数组长度,如果小于等于1则排好序(递归出口)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 7&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     $len = count($arr);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     if($len &amp;lt;= 1)return $arr;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 9&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //取出比较数据&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     $data = $arr[0];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;11&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //比较,小于$data的数据放左边数组,大于的放右边数组&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     $left = $right = array();&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;13&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     for($i = 1;$i &amp;lt; $len;$i++){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         if($arr[$i] &amp;lt; $data){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;15&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             $left[] = $arr[$i];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;16&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         }else{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;17&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             $right[] = $arr[$i];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;18&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         }&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     }&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //递归点(可能左边和右边数组未排好序,则递归~)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     $left = quick_sort($left);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;22&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     $right = quick_sort($right);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;23&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //合并数组&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     return array_merge($left, array($data), $right);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;x&quot;&gt; }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
</description>
      </item>
    
      <item>
        <title>Cookie禁用了，Session还能用吗？</title>
        <link>http://杨柳青一些事.中国/2014/06/07/Cookie-and-Session-advance.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2014/06/07/Cookie-and-Session-advance.html</guid>
        <pubDate>Sat, 07 Jun 2014 00:00:00 +0800</pubDate>
        <description>&lt;p&gt;很必要的一个问题,因为有一部分童鞋觉得cookie不安全,于是就禁用cookie,结果session就哭了-,-&lt;/p&gt;

&lt;hr&gt;

&lt;h3&gt;session哭了&lt;/h3&gt;

&lt;p&gt;　　Cookie与 Session，一般认为是两个独立的东西，Session采用的是在服务器端保持状态的方案，而Cookie采用的是在客户端保持状态的方案。但为什么禁用Cookie就不能得到Session呢？因为Session是用&lt;code&gt;Session ID&lt;/code&gt;来确定当前对话所对应的服务器Session，而&lt;code&gt;Session ID是通过Cookie来传递&lt;/code&gt;的，禁用Cookie相当于失去了Session ID，也就得不到Session了。&lt;/p&gt;

&lt;h3&gt;session不哭,站起来撸&lt;/h3&gt;

&lt;p&gt;　　Session，储存于服务器端（默认以文件方式存储Session），&lt;code&gt;根据客户端提供的Session ID来得到用户的文件，取得变量的值&lt;/code&gt;，Session ID可以使用客户端的Cookie或者Http1.1协议的Query_String（就是访问的URL的“?”后面的部分）来传送给服务器，然后服务器读取Session的目录……。也就是说，&lt;code&gt;Session ID是取得存储在服务上的Session变量的身份证&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;　　当代码session&lt;em&gt;start();运行的时候，就在服务器上&lt;code&gt;产生了一个Session文件，随之也产生了与之唯一对应的一个Session ID&lt;/code&gt;，定义Session变量以一定形式存储刚才产生的Session文件。通过Session ID，可以取出定义的变量。跨页后，为了使用Session，你必须又执行session&lt;/em&gt;start();将&lt;code&gt;又会产生一个Session文件，与之对应产生相应的Session ID&lt;/code&gt;，用这个session id是取不出前面提到的第一个Session文件中的变量的，因为这个Session ID不是打开它的“钥匙”。&lt;code&gt;如果在session_start();之前加代码session_id($session id);将不产生新的Session文件，直接读取与这个id对应的Session文件&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;我们可以抛开Cookie使用Session，即假定用户关闭Cookie的情况下使用Session，其实现途径有以下几种：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;设置php.ini配置文件中的&lt;code&gt;session.use_trans_sid = 1&lt;/code&gt;，或者编译时打开打开了&lt;code&gt;--enable-trans-sid&lt;/code&gt;选项，让PHP自动跨页传递Session ID。&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;lineno&quot;&gt; 1&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;-------------------------------------------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// s1.php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4&lt;/span&gt;            &lt;span class=&quot;nb&quot;&gt;session_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 5&lt;/span&gt;            &lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;lalala&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;papapa&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 6&lt;/span&gt;            &lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;&amp;lt;a href=&amp;#39;s2.php&amp;#39;&amp;gt;下一页&amp;lt;/a&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 7&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8&lt;/span&gt;        &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 9&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       -------------------------------------------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;11&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       -------------------------------------------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;13&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// s2.php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;14&lt;/span&gt;            &lt;span class=&quot;nb&quot;&gt;session_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;15&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;lalala&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;16&lt;/span&gt;        &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;17&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       -------------------------------------------------------------------------------------------------------------------&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;运行以上代码，在客户端cookie正常的情况下，应该可以得到结果&amp;quot;papapa&amp;quot;。
现在你手动关闭客户端的cookie，再运行，可能得不到结果了吧。如果得不到结果，再设置php.ini文件中的&lt;code&gt;session.use_trans_sid = 1&lt;/code&gt;，或者编译时打开打开了&lt;code&gt;--enable-trans-sid选项&lt;/code&gt;，又得到结果“papapa”。 &lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;手动通过URL传值、隐藏表单传递Session ID。&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;lineno&quot;&gt; 1&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;-------------------------------------------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// s1.php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4&lt;/span&gt;            &lt;span class=&quot;nb&quot;&gt;session_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 5&lt;/span&gt;            &lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;lalala&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;papapa&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 6&lt;/span&gt;            &lt;span class=&quot;nv&quot;&gt;$sn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;session_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 7&lt;/span&gt;            &lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;&amp;lt;a href=&amp;#39;s2.php?sn=&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$sn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;&amp;#39;&amp;gt;下一页&amp;lt;/a&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 9&lt;/span&gt;        &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       -------------------------------------------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;11&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       -------------------------------------------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;13&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;14&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;// s2.php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;15&lt;/span&gt;            &lt;span class=&quot;nb&quot;&gt;session_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;sn&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;16&lt;/span&gt;            &lt;span class=&quot;nb&quot;&gt;session_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;17&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;lalala&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;18&lt;/span&gt;        &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       -------------------------------------------------------------------------------------------------------------------&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;用文件、数据库等形式保存Session ID，在跨页过程中手动调用。&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;lineno&quot;&gt; 1&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;-------------------------------------------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       login.html&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &amp;lt;!DOCTYPE HTML PUBLIC &amp;quot;-//W3C//DTD HTML 4.01 Transitional//EN&amp;quot;&amp;gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &amp;lt;html&amp;gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 5&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &amp;lt;head&amp;gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 6&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &amp;lt;title&amp;gt;Login&amp;lt;/title&amp;gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 7&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &amp;lt;meta http-equiv=&amp;quot;Content-Type&amp;quot; content=&amp;quot;text/html; charset=gb2312&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &amp;lt;/head&amp;gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 9&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &amp;lt;body&amp;gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       请登录： &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;11&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &amp;lt;form name=&amp;quot;login&amp;quot; method=&amp;quot;post&amp;quot; action=&amp;quot;mylogin1.php&amp;quot;&amp;gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       用户名:&amp;lt;input type=&amp;quot;text&amp;quot; name=&amp;quot;name&amp;quot;&amp;gt;&amp;lt;br&amp;gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;13&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       口　令:&amp;lt;input type=&amp;quot;password&amp;quot; name=&amp;quot;pass&amp;quot;&amp;gt;&amp;lt;br&amp;gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &amp;lt;input type=&amp;quot;submit&amp;quot; value=&amp;quot;登录&amp;quot;&amp;gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;15&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &amp;lt;/form&amp;gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;16&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &amp;lt;/body&amp;gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;17&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &amp;lt;/html&amp;gt; &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;18&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       -------------------------------------------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;19&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       -------------------------------------------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       mylogin1.php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;22&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;23&lt;/span&gt;        &lt;span class=&quot;nv&quot;&gt;$name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;’name’&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;24&lt;/span&gt;        &lt;span class=&quot;nv&quot;&gt;$pass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;’pass’&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;25&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$pass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;26&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;用户名或密码为空，请&amp;lt;a href=&amp;#39;login.html&amp;#39;&amp;gt;重新登录&amp;lt;/a&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;27&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;die&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;28&lt;/span&gt;        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;29&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;lalala&amp;quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$pass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;papapa&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;30&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;用户名或密码不正确，请&amp;lt;a href=&amp;#39;login.html&amp;#39;&amp;gt;重新登录&amp;lt;/a&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#随便测试写,不要注意这些细节-,-&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;31&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;die&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;32&lt;/span&gt;        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;33&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;//注册用户&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;34&lt;/span&gt;        &lt;span class=&quot;nb&quot;&gt;ob_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;                                &lt;span class=&quot;c1&quot;&gt;#ob缓存&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;35&lt;/span&gt;        &lt;span class=&quot;nb&quot;&gt;session_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;                           &lt;span class=&quot;c1&quot;&gt;#session开启&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;36&lt;/span&gt;        &lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;’user’&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;             &lt;span class=&quot;c1&quot;&gt;#设置session&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;37&lt;/span&gt;        &lt;span class=&quot;nv&quot;&gt;$psid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;session_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;                     &lt;span class=&quot;c1&quot;&gt;#保存session id&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;38&lt;/span&gt;        &lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fopen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;D:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;mp\phpsid.txt&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;w+&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;      &lt;span class=&quot;c1&quot;&gt;#打开文件&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;39&lt;/span&gt;        &lt;span class=&quot;nb&quot;&gt;fwrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$psid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                       &lt;span class=&quot;c1&quot;&gt;#把session id写入文件&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;40&lt;/span&gt;        &lt;span class=&quot;nb&quot;&gt;fclose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                                &lt;span class=&quot;c1&quot;&gt;#关闭文件&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;41&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;//身份验证成功，进行相关操作&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;42&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;已登录&amp;lt;br&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;43&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;&amp;lt;a href=&amp;#39;mylogin2.php&amp;#39;&amp;gt;下一页&amp;lt;/a&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;44&lt;/span&gt;        &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;45&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       -------------------------------------------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;46&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;47&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       -------------------------------------------------------------------------------------------------------------------&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;48&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       mylogin2.php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;49&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       &lt;/span&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;50&lt;/span&gt;        &lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fopen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;D:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;mp\phpsid.txt&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;r&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;       &lt;span class=&quot;c1&quot;&gt;#打开文件&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;51&lt;/span&gt;        &lt;span class=&quot;nv&quot;&gt;$sid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                 &lt;span class=&quot;c1&quot;&gt;#取出session id&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;52&lt;/span&gt;        &lt;span class=&quot;nb&quot;&gt;fclose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                                &lt;span class=&quot;c1&quot;&gt;#关闭文件&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;53&lt;/span&gt;        &lt;span class=&quot;nb&quot;&gt;session_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$sid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;                       &lt;span class=&quot;c1&quot;&gt;#设置session id&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;54&lt;/span&gt;        &lt;span class=&quot;nb&quot;&gt;session_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;                           &lt;span class=&quot;c1&quot;&gt;#开启session&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;55&lt;/span&gt;        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;isset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;’user’&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_SESSION&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;’user’&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;laigw&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;56&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;已登录!&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;57&lt;/span&gt;        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;58&lt;/span&gt;            &lt;span class=&quot;c1&quot;&gt;//成功登录进行相关操作&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;59&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;未登录，无权访问&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;60&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;请&amp;lt;a href=&amp;quot;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;login&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;&amp;gt;登录&amp;lt;/a&amp;gt;后浏览&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;61&lt;/span&gt;            &lt;span class=&quot;k&quot;&gt;die&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;62&lt;/span&gt;        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;63&lt;/span&gt;        &lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;span class=&quot;x&quot;&gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;       -------------------------------------------------------------------------------------------------------------------&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;同样请关闭Cookie测试，用户名：lalala；密码：lalala；这是通过文件保存Session ID的，文件是：D:/tmp/phpsid.txt，请根据自己的系统决定文件名或路径。 &lt;/p&gt;

&lt;p&gt;总结一下，上面的方法有一个共同点，就是在前一页取得Session ID，然后想办法传递到下一页，在下一页的session_start();代码之前加代码Session ID(传过来的Session ID)。&lt;/p&gt;

&lt;p&gt;打完收工:p&lt;/p&gt;
</description>
      </item>
    
      <item>
        <title>Cookie与Session -- 原理</title>
        <link>http://杨柳青一些事.中国/2014/05/30/Cookie-and-Session-principle.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2014/05/30/Cookie-and-Session-principle.html</guid>
        <pubDate>Fri, 30 May 2014 00:00:00 +0800</pubDate>
        <description>&lt;p&gt;之前有写过一篇&lt;a href=&quot;http://arrowjustdoit.github.io/2014/05/25/Cookie-and-Session.html&quot;&gt;Cookie与Session&lt;/a&gt;更多是在讲解写简单的实际操作,今天在网上看到一些通俗易懂的原理,分享下&lt;/p&gt;

&lt;hr&gt;

&lt;h3&gt;&lt;strong&gt;作用&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;　　服务器可以&lt;code&gt;利用Cookies或Session包含信息的任意性来筛选并经常性维护这些信息&lt;/code&gt;，以判断在HTTP传输中的状态。它们最典型的应用是&lt;code&gt;判定注册用户是否已经登录网站&lt;/code&gt;，用户可能会得到提示，是否在下一次进入此网站时保留用户信息以便简化登录手续。另一个重要应用场合是&lt;code&gt;“购物车”&lt;/code&gt;之类处理。用户可能会在一段时间内在同一家网站的不同页面中选择不同的商品，这些信息都会写入Cookies或Session，以便在最后付款时提取信息。总而言之，cookies和session就是能够&lt;code&gt;记录顾客状态&lt;/code&gt;的技术，尽管二者属于不同的技术，但只要cookies能做到的，session也能做到&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;打个比方&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;　　我常到一家熟食店买馋嘴鸭，该店老板为了促进销售，特发布“每购满10只即可免费赠送一只”的优惠措施。除了家里有什么红白喜事要飨客之外，应该不会有人一次性购买10只烤鸭吧？所以老板得想个法子来记录顾客的消费数量，这里总共有三种方案：&lt;/p&gt;

&lt;p&gt;Ⅰ、老板&lt;code&gt;记住每一个顾客的消费数量&lt;/code&gt;，等到顾客消费满10只的时候自动奉送一只。这好比HTTP协议本身是有状态的，可以记住顾客的活动行为。但遗憾的是，出于种种考虑&lt;code&gt;http协议本身是不能有状态的&lt;/code&gt;，老板自个也没有这么超常的记忆力，故这种方案行不通！&lt;/p&gt;

&lt;p&gt;Ⅱ、老板发给顾客一张&lt;code&gt;积分卡&lt;/code&gt;，上面记录着消费的数量，一般还有个有效期限。每次买烤鸭时，如果顾客出示这张卡片，老板就知道这位顾客曾经光顾过小店。这种做法就是在&lt;code&gt;客户端保持状态&lt;/code&gt;，好比是cookie技术。打开（windows系统）C:\Documents and Settings\用户名\Cookies，你会发现一些*.txt格式的小文件，这就是你浏览某些网站，它们发给你的“积分卡”(cookies)。&lt;/p&gt;

&lt;p&gt;Ⅲ、老板发给顾客一张&lt;code&gt;会员卡&lt;/code&gt;，&lt;code&gt;除了卡号之外什么信息也不纪录&lt;/code&gt;，每次买烤鸭时，如果顾客出示该卡片，则老板搬出店里的划名册，找到你的卡号并加1个积分。这种做法就是在&lt;code&gt;服务器端保持状态&lt;/code&gt;。好比是session技术。&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;区别和联系&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;cookie和session最大的区别在于： &lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;cookie是把&lt;code&gt;积分卡&lt;/code&gt;发给顾客，上面&lt;code&gt;记录了顾客所有的消费信息&lt;/code&gt;。Session则是把只有&lt;code&gt;卡号&lt;/code&gt;(session id)的积分卡发给顾客，&lt;code&gt;自家记录了顾客所有的消费信息&lt;/code&gt;。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Cookie是保存在&lt;code&gt;客户端&lt;/code&gt;的；session是保存在&lt;code&gt;服务器端&lt;/code&gt;，而session id则是保存在&lt;code&gt;客户端&lt;/code&gt;，通常也是一个cookie小文件，由于这个小文件除了session id(好比卡号)外什么也没有，因此比cookie安全多了。&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;具体来说cookie机制采用的是在&lt;code&gt;客户端保持状态&lt;/code&gt;的方案，而session机制采用的是在&lt;code&gt;服务器端保持状态&lt;/code&gt;的方案。同时我们也看到，由于采用服务器端保持状态的方案在客户端也需要保存一个标识，所以session机制可能需要借助于cookie机制来达到保存标识的目的，但实际上它还有其他选择。&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;原理&lt;/strong&gt;&lt;/h3&gt;

&lt;h3&gt;cookie机制&lt;/h3&gt;

&lt;p&gt;　　正统的cookie分发是通过扩展HTTP协议来实现的，服务器通过在HTTP的响应头中加上一行特殊的指示以提示浏览器按照指示生成相应的cookie。然而纯粹的客户端脚本如JavaScript或者VBScript也可以生成cookie。而cookie的使用是由浏览器按照一定的原则在后台自动发送给服务器的。浏览器检查所有存储的cookie，如果某个cookie所声明的作用范围大于等于将要请求的资源所在的位置，则把该cookie附在请求资源的HTTP请求头上发送给服务器。&lt;/p&gt;

&lt;p&gt;cookie的内容主要包括：名字，值，过期时间，路径和域。路径与域一起构成cookie的作用范围。若不设置过期时间，则表示这个cookie的生命期为浏览器会话期间，关闭浏览器窗口，cookie就消失。这种生命期为浏览器会话期的cookie被称为&lt;code&gt;会话cookie&lt;/code&gt;。会话cookie一般不存储在硬盘上而是保存在内存里，当然这种行为并不是规范规定的。若设置了过期时间，浏览器就会把cookie保存到硬盘上，关闭后再次打开浏览器，这些cookie仍然有效直到超过设定的过期时间。存储在硬盘上的cookie可以在不同的浏览器进程间共享，比如两个IE窗口。而对于保存在内存里的cookie，不同的浏览器有不同的处理方式&lt;/p&gt;

&lt;h3&gt;session机制&lt;/h3&gt;

&lt;p&gt;　　session机制是一种服务器端的机制，服务器使用一种类似于散列表的结构（也可能就是使用散列表）来保存信息。当程序需要为某个客户端的请求创建一个session时，服务器首先检查这个客户端的请求里是否已包含了一个session标识（称为session id），如果已包含则说明以前已经为此客户端创建过session，服务器就按照session id把这个session检索出来使用（检索不到，会新建一个），如果客户端请求不包含session id，则为此客户端创建一个session并且生成一个与此session相关联的session id，session id的值应该是一个既不会重复，又不容易被找到规律以仿造的字符串，这个session id将被在本次响应中返回给客户端保存。 保存这个session id的方式可以采用cookie，这样在交互过程中浏览器可以自动的按照规则把这个标识发挥给服务器。一般这个cookie的名字都是类似于SEEESIONID。但cookie可以被人为的禁止，则必须有其他机制以便在cookie被禁止时仍然能够把session id传递回服务器。 &lt;/p&gt;

&lt;p&gt;打完收工:p&lt;/p&gt;
</description>
      </item>
    
      <item>
        <title>Cookie与Session</title>
        <link>http://杨柳青一些事.中国/2014/05/25/Cookie-and-Session.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2014/05/25/Cookie-and-Session.html</guid>
        <pubDate>Sun, 25 May 2014 00:00:00 +0800</pubDate>
        <description>&lt;p&gt;最近忙着期末考试,也没有什么时间研究技术了-,- 所以自己整理下平时对session和cookie的理解&lt;/p&gt;

&lt;hr&gt;

&lt;h3&gt;&lt;strong&gt;会话技术&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;会话技术&lt;/strong&gt;: 在一次浏览器打开后,多次访问同一个网站的时候, 都认为当前浏览器是已经访问网站的(服务器记住浏览器): 从而实现跨脚本的共享数据.&lt;/p&gt;

&lt;p&gt;会话技术包含两种: cookie和session技术&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Cookie技术&lt;/strong&gt;: 
是一种服务器通过http协议将数据保存到浏览器端, 然后浏览器又通过http协议将数据携带给服务器的技术. 从而实现服务器识别浏览器的功能.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Session技术&lt;/strong&gt;: 
session是一种将数据保存在服务器端的技术, 通过将”信物”通过http协议(cookie)保存到浏览器端, 浏览器通过cookie将”信物”携带给服务器, 服务器通过”信服”找到对应的数据, 从而实现跨脚本共享数据.&lt;/p&gt;

&lt;h3&gt;&lt;strong&gt;Cookie技术&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;Cookie: 服务器将数据通过HTTP协议保存到浏览器, 然后浏览器在下次访问(HTTP协议)的时候将数据携带给服务器, 实现服务器识别浏览器的目的(数据共享).&lt;/p&gt;

&lt;p&gt;Cookie技术是会话技术的鼻祖&lt;/p&gt;

&lt;p&gt;Cookie技术实现是基于HTTP协议中的两个协议项:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;响应头: set-cookie ,服务器设置数据给浏览器&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;请求头: cookie, 浏览器携带数据给服务器&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;如何设置cookie&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;header实现Cookie&lt;/strong&gt;:修改响应头将数据传递给浏览器&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;Header(‘set-cookie: 名字 = 值’);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Setcookie函数&lt;/strong&gt;:一个专门用于设置cookie的函数&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;Setcookie(名字,值，参数3，参数4，参数5);
Setcookie(&amp;#39;age&amp;#39;,18);                           //参数1：cookie的名字。参数2：cookie的值
Setcookie(&amp;#39;age&amp;#39;,18,time()+10);                 //参数3：Cookie生命周期--&amp;gt;当前时间再过10秒后失效
Setcookie(&amp;#39;age&amp;#39;,18,time()+10,&amp;#39;/&amp;#39;)；            //参数4：Cookie作用范围--&amp;gt;‘/’表示整个网站下都能访问
Setcookie(&amp;#39;age&amp;#39;,18,time()+10,&amp;#39;/&amp;#39;,&amp;#39;lalala.com&amp;#39;);//参数5：Cookie跨域--&amp;gt;默认的,cookie是不能跨域的,这样设置的话只要以lalala.com结束的域名都可以访问
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;如何接收cookie&lt;/h3&gt;

&lt;p&gt;PHP使用一个超全局预定义变量$_COOKIE自动接收所有的cookie数据&lt;/p&gt;

&lt;p&gt;要想接收数组可以通过设置cookie的时候借助于[]实现&lt;/p&gt;

&lt;h3&gt;Cookie总结&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt; Cookie不安全: 谁都可以访问(js),通常不会使用cookie来保存重要的数据&lt;/li&gt;
&lt;li&gt; Cookie适合保存不重要而且数据量大的东西.(视频网站)&lt;/li&gt;
&lt;li&gt; Cookie保存在浏览器端&lt;/li&gt;
&lt;/ol&gt;

&lt;h3&gt;&lt;strong&gt;Session技术&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;Session: 将数据保存在服务器端的技术. 是一种将数据保存到服务器上的文件中.&lt;/p&gt;

&lt;p&gt;Session技术是基于cookie技术实现.&lt;/p&gt;

&lt;p&gt;Session是通过产生sessionID(cookie), 去创建对应的文件,然后将数据保存到文件中, 将sessionid发送给浏览器. 浏览器携带sessionid,服务器能够接收id并且找到文件取出数据.&lt;/p&gt;

&lt;p&gt;核心的工作: 都是由session_start()完成&lt;/p&gt;

&lt;h3&gt;如何设置Session&lt;/h3&gt;

&lt;p&gt;Session技术有两种实现方式(类似mysql中的事务处理): &lt;code&gt;手动session&lt;/code&gt;和&lt;code&gt;自动session&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Session在PHP系统中有一套完整的机制(用户不需要管内部实现), 对外提供了一些可以操作的接口(应用接口: 函数)&lt;/p&gt;

&lt;h3&gt;手动session&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;激活session系统: 让session系统开始工作&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;Session_start(): #开启session机制, 任何要使用session之前都必须开启session机制
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;PHPSESSID这个cookie由session_start()函数产生,就是session数据的”钥匙”&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;存储数据到session中: 使用$_SESSION存储数据&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;Session_start();
$_SESSION[‘name’] = ‘mark’;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;在新的脚本中读取session数据: 任何想使用session的时候都必须开启session&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;Session_start();
Var_dump($_SESSION);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;自动session&lt;/h3&gt;

&lt;p&gt;自动session: session机制一直是打开的,根本不需要用户去开启session.&lt;/p&gt;

&lt;p&gt;用户要做的事情是: 存储数据($&lt;em&gt;SESSION),使用数据($&lt;/em&gt;SESSION)&lt;/p&gt;

&lt;p&gt;要实现自动session: 必须修改配置文件自动开启&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;;session自动开启
;session.auto_start = 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;通常不会使用自动session.=.=&lt;/p&gt;

&lt;h3&gt;如何删除Session&lt;/h3&gt;

&lt;p&gt;删除session文件: 在开启session之后,session_destroy();&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;Session_start();
Session_destroy();
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Session文件的删除是根据sessionID删除: 一个浏览器的一次请求永远只能删除对应的sessionid的session文件.&lt;/p&gt;

&lt;h3&gt;如何配置Session&lt;/h3&gt;

&lt;p&gt;Session数据的存储方式: 默认是文件&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;修改session数据的存储方式--&amp;gt;存储到文件里面
session.save_handler = files
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Session的存储路径: 默认的是操作系统的临时文件夹&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;;设置session数据的存储位置--&amp;gt;存到文件中
session.save_path = &amp;quot;F:\Program Files (x86)\server\TEMP&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Session是基于cookie: 使用cookie保存sessionid&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;session.use_cookies = 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Session只允许使用cookie保存sessionid&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;session.use_only_cookies = 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Session名称: cookie中sessionid的名字&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;session.name = PHPSESSID
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Session默认不是自动开启&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;session.auto_start = 0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Session过期: 因为sessionid的cookie生命周期: 浏览器关闭&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;session.cookie_lifetime = 0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Sessionid的cookie作用范围是整站共享&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;session.cookie_path = /
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Session数据保存是使用php自己的序列化方式(序列化不是对$&lt;em&gt;SESSION序列化,而是对$&lt;/em&gt;SESSION里面的数据进行序列[下标不序列化])&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;session.serialize_handler = php
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Session垃圾回收机制&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;session.gc_probability = 1
session.gc_divisor = 1000           #session_start开启1000次有一次可能触发垃圾回收机制,一次性回收所有垃圾文件
session.gc_maxlifetime = 1440       #session文件的生命周期是24分钟
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Session默认不允许将sessionid存储到a标签里面的href中&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;session.use_trans_sid = 0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Session分层&lt;/h3&gt;

&lt;p&gt;有可能网站的瞬时访问量很大, 会产生很多的session文件: 因为操作系统寻找文件是逐个匹配: 效率特别低.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;解决方案1: 将session文件放到不同的文件夹下: 以sessionID的首字母为文件夹&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;使用分层的缺点1&lt;/code&gt;: 需要手动创建文件夹(系统不会自动创建)&lt;/p&gt;

&lt;p&gt;为了保证安全性: 必须手动创建36个(26个字母+10个数字)文件夹,如果分成两层: 36 * 36个文件&lt;/p&gt;

&lt;p&gt;&lt;code&gt;使用分层的缺点2&lt;/code&gt;: 文件读取有i/o限制(并发问题)&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;解决方案2:将session保存到数据库(数据库的并发量比文件要高的多:  数据库可以是非关系型数据库[内存])&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;打完收工:p&lt;/p&gt;
</description>
      </item>
    
      <item>
        <title>php文件上传</title>
        <link>http://杨柳青一些事.中国/2014/05/01/files-upload.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2014/05/01/files-upload.html</guid>
        <pubDate>Thu, 01 May 2014 00:00:00 +0800</pubDate>
        <description>&lt;p&gt;通过 PHP，可以把文件上传到&lt;code&gt;服务器&lt;/code&gt;&lt;/p&gt;

&lt;h3&gt;什么是文件上传&lt;/h3&gt;

&lt;p&gt;把&lt;code&gt;浏览器&lt;/code&gt;所在电脑的文件存放到&lt;code&gt;服务器&lt;/code&gt;上, 这个过程称之为文件上传&lt;/p&gt;

&lt;p&gt;上传分为两个部分: &lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;将浏览器所在电脑的文件选中,提交给服务器,服务器要接收文件.&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;服务器必须要接收文件: apache不能接收文件,PHP负责接收.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3&gt;前期准备&lt;/h3&gt;

&lt;h4&gt;&lt;code&gt;设置php.ini&lt;/code&gt;&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;确保上传功能被打开&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;file_uploads = On
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;设置上传文件的临时存放目录&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;upload_tmp_dir =&amp;quot;E:\PHP\upload&amp;quot;      #;设置文件上传临时保存路径,默认是在c:/windows/temp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;&lt;code&gt;设置文件表单域&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;&amp;lt;input type=’file’ name=’myfile’&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;&lt;code&gt;设置post提交二进制&lt;/code&gt;&lt;/h4&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;enctype=”multipart/form-data”
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;&lt;code&gt;$_FILES获取的数据&lt;/code&gt;&lt;/h4&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;lineno&quot;&gt; 1&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;array(1) {&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  [&amp;quot;myfile&amp;quot;]=&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  array(5) {&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;    [&amp;quot;name&amp;quot;]=&amp;gt;                                          #上传文件的文件名&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 5&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;    string(10) &amp;quot;123123.jpg&amp;quot;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 6&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;    [&amp;quot;type&amp;quot;]=&amp;gt;                                          #上传文件的类型:大类型/格式  称为MIME类型&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 7&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;    string(10) &amp;quot;image/jpeg&amp;quot;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;    [&amp;quot;tmp_name&amp;quot;]=&amp;gt;                                      #上传到服务器时临时存储文件路径&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 9&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;    string(38) &amp;quot;E:\PHP\upload\php7FC2.tmp&amp;quot;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;    [&amp;quot;error&amp;quot;]=&amp;gt;                                         #错误描述码&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;11&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;    int(0)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;    [&amp;quot;size&amp;quot;]=&amp;gt;                                          #上传文件大小&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;13&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;    int(6340)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  }&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;15&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;使用的函数&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Move_uploaded_file(文件所在目录[文件名], 文件要存储的目录[带文件名])&lt;/code&gt;移动文件--&amp;gt;原文件不存在&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Copy(文件所在目录,文件要存储的目录&lt;/code&gt;复制文件--&amp;gt;原文件存在&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;使用时注意的问题&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;move_uploaded_file()&lt;/code&gt;会事先检测源文件是否通过php上传过来的，否则不予移动(&lt;code&gt;只能用post&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;move_uploaded_file()&lt;/code&gt;这个函数虽然&lt;code&gt;多次调用但是只能执行一次&lt;/code&gt;，原因就在于&lt;code&gt;move_uploaded_file()&lt;/code&gt;只支持post提交的信息，也就是用户只提交了一个post，第一次调用被执行后，之后就不是post的值也就是说不在执行了，解决办法就是&lt;code&gt;用copy代替move_uploaded_file()&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;封装一个上传文件函数&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;lineno&quot;&gt; 1&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;/*&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  * 上传文件&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  * @param1 array $file,要上传的文件信息&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  * @param2 string $path,文件要上传的路径&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 5&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  * @param3 string &amp;amp;$error,记录错误信息&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 6&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  * @return string 文件的名字(新名字)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 7&lt;/span&gt; &lt;span class=&quot;x&quot;&gt; */&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8&lt;/span&gt; &lt;span class=&quot;x&quot;&gt; function upload($file,$path,&amp;amp;$error){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 9&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //定义错误信息: 专门记录错误: 在函数外部能访问&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //验证$file的合法性&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;11&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     if(!is_array($file)){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         //不是数组&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;13&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         $error = &amp;#39;上传文件不合法!&amp;#39;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         return false;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;15&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     }&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;16&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //验证系统错误处理&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;17&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     switch($file[&amp;#39;error&amp;#39;]){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;18&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         case 1:&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             $error = &amp;#39;文件过大,超过服务器允许的大小!&amp;#39;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             return false;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         case 2:&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;22&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             $error = &amp;#39;文件超过浏览器允许的大小!&amp;#39;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;23&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             return false;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         case 3:&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             $error = &amp;#39;文件只上传部分!&amp;#39;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;26&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             return false;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;27&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         case 4:&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;28&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             $error = &amp;#39;用户没有选中要上传的文件!&amp;#39;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;29&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             return false;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         case 6:&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;31&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         case 7:&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             $error = &amp;#39;服务器错误!&amp;#39;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;33&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             return false;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;34&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     }&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;35&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //都没有错误: 移动文件&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;36&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     $filename = getRandomName($file[&amp;#39;name&amp;#39;]);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;37&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     if(@move_uploaded_file($file[&amp;#39;tmp_name&amp;#39;],$path . &amp;#39;/&amp;#39; . $filename))&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;38&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     {&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;39&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         //成功&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;40&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         return $filename;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;41&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     }else{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;42&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         //失败&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;43&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         $error = &amp;#39;文件移动失败!&amp;#39;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;44&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         return false;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;45&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     }&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;46&lt;/span&gt; &lt;span class=&quot;x&quot;&gt; }&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;47&lt;/span&gt; &lt;span class=&quot;x&quot;&gt; /*&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;48&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  * 生成文件名: YYYYmmddHHIISS + 随机6位字符串&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;49&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  * @param1 string $name,文件原始名字: 在浏览器所在电脑的名字&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;50&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  * @return string 新的名字&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;51&lt;/span&gt; &lt;span class=&quot;x&quot;&gt; */&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;52&lt;/span&gt; &lt;span class=&quot;x&quot;&gt; function getRandomName($name){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;53&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //构造时间日期部分&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;54&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     $newname = date(&amp;#39;YmdHis&amp;#39;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;55&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //获取随机部分&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;56&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     $str = &amp;#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890&amp;#39;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;57&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //随机取6位&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;58&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     for($i = 0; $i &amp;lt; 6;$i++){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;59&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         //每次随机取一位&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         $newname .= $str[mt_rand(0,strlen($str) - 1)];&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;61&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     }&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;62&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //构造后缀名&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;63&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     $newname .= strrchr($name,&amp;#39;.&amp;#39;);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //返回&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;65&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     return $newname;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;66&lt;/span&gt; &lt;span class=&quot;x&quot;&gt; }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
</description>
      </item>
    
      <item>
        <title>php递归遍历文件夹</title>
        <link>http://杨柳青一些事.中国/2014/04/22/Recursive-Traversal.html</link>
        <guid isPermaLink="true">http://杨柳青一些事.中国/2014/04/22/Recursive-Traversal.html</guid>
        <pubDate>Tue, 22 Apr 2014 00:00:00 +0800</pubDate>
        <description>&lt;p&gt;用递归实现遍历文件夹及其子目录&lt;/p&gt;

&lt;hr&gt;

&lt;h3&gt;什么是递归&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;递归&lt;/strong&gt;: 函数不断的调用函数,开辟内存: 是一种典型使用空间换时间的思想(突然间内存被大量占用,效率很高)。&lt;/p&gt;

&lt;p&gt;当一个函数是为了解决某一个问题的时候, 发现在解决的过程中, 出现了子问题与本身要解决的问题(父问题)一致: 子问题与父问题一致,只是规模比较小.&lt;/p&gt;

&lt;p&gt;如果碰到了相同的问题, 可以使用父问题的解决方案去解决子问题: &lt;code&gt;调用函数自己&lt;/code&gt;&lt;/p&gt;

&lt;h3&gt;递归有两个要素&lt;/h3&gt;

&lt;p&gt;1 &lt;strong&gt;递归点&lt;/strong&gt;: 解决父问题过程中,发现了子问题与父问题一致: 递归点: 递归调用函数&lt;/p&gt;

&lt;p&gt;2 &lt;strong&gt;递归出口&lt;/strong&gt;: 保证函数能够结束的地方就是递归出口&lt;/p&gt;

&lt;h3&gt;思路&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;使用函数解决当前需要解决的问题: 不考虑子问题&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;寻找递归点: 函数在解决问题的过程中,有没有碰到与父问题相似的问题: 父问题是遍历文件夹: 子问题: 遍历出来的文件刚好又是文件夹&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;消除产生死递归的要素: .和..文件夹: 一个代表当前,一个代表上级&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;递归调用函数: 解决子问题&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;寻找递归出口: 整个文件夹遍历结束也没有发现文件夹:都是文件或者.和..文件夹&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;增加子文件的缩进: 子文件夹的遍历都是由上一级发展而来: 如果能够在每一层使用scandir的地方,定义一个层级来控制: 就可以描述当前层级是属于第几级,级别代表当前所属哪层一层文件夹: 级别就代表着缩进&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3&gt;代码实现&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;lineno&quot;&gt; 1&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;/*&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  * 实现遍历文件夹及其子目录&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  * @param1 string $dir,要获取文件的路径&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  * @param1 int $level=0,缩进层级&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 5&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;  * @return 失败返回false 成功返回遍历结果&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 6&lt;/span&gt; &lt;span class=&quot;x&quot;&gt; */&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 7&lt;/span&gt; &lt;span class=&quot;x&quot;&gt; function myscandir($dir, $level = 0){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //判断路径是否合法&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 9&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     if(!is_dir($dir)) return false;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //取出该路径下的所有文件名(以数组的形式)&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;11&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     $files = scandir($dir);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     //遍历数组&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;13&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     foreach($files as $file){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         //剔除.与..目录&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;15&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         if($file != &amp;#39;.&amp;#39; &amp;amp;&amp;amp; $file != &amp;#39;..&amp;#39;){      &lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;16&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             //构造新路径&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;17&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             $new_dir = $dir . &amp;#39;/&amp;#39; . $file;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;18&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             //判断输出&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             if(is_file($new_dir)){&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;                 //是文件,则以蓝色字体输出&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;                 echo str_repeat(&amp;#39;&amp;amp;nbsp;&amp;amp;nbsp&amp;#39;, $level * 2),&amp;quot;&amp;lt;font color=&amp;#39;blue&amp;#39;&amp;gt;$file&amp;lt;/font&amp;gt;&amp;lt;br/&amp;gt;&amp;quot;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;22&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             }else{&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;23&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;                 //是路径,则以红色字体输出并继续遍历&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;                 echo str_repeat(&amp;#39;&amp;amp;nbsp;&amp;amp;nbsp&amp;#39;, $level * 2),&amp;quot;&amp;lt;font color=&amp;#39;red&amp;#39;&amp;gt;$file&amp;lt;/font&amp;gt;&amp;lt;br/&amp;gt;&amp;quot;;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;                 //递归点&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;26&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;                 myscandir($new_dir, $level + 1);&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;27&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;             }&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;28&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;         }&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;29&lt;/span&gt; &lt;span class=&quot;x&quot;&gt;     }&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;x&quot;&gt; }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;打完收工:p&lt;/p&gt;
</description>
      </item>
    
  </channel>
</rss>